<tw-storydata name="Winter" startnode="1" creator="Twine" creator-version="2.2.1" ifid="935487F1-8031-4BF1-8111-98262BE1BF4D" zoom="0.6" format="SugarCube" format-version="2.28.2" options="" hidden><style role="stylesheet" id="twine-user-stylesheet" type="text/twine-css">#ui-bar-history
{
  display: none;
}

.hidden a {
    color: transparent;
}

.shadow {
	text-shadow: 0.08em 0.08em 0.08em #FFF;
}

.emboss {
	text-shadow: 0.08em 0.08em 0em #FFF;
	color: black;
}

.blur {
	color: transparent;
	text-shadow: 0em 0em 0.08em #FFF;
}
.blurrier {
	color: transparent;
	text-shadow: 0em 0em 0.2em #FFF;
}

.blurrier::selection {
	background-color: transparent;
	color: transparent;
}
.blurrier::-moz-selection {
	background-color: transparent;
	color: transparent;
}
.smear {
	color: transparent;
	text-shadow:
		0em    0em 0.02em rgba(255,255,255,0.75),
		-0.2em 0em 0.5em  rgba(255,255,255,0.5),
		0.2em  0em 0.5em  rgba(255,255,255,0.5);
}
.mirror {
	display: inline-block;
	transform: scaleX(-1);
	-webkit-transform: scaleX(-1);
}
.upside-down {
	display: inline-block;
	transform: scaleY(-1);
	-webkit-transform: scaleY(-1);
}

@-webkit-keyframes fade-in-out {
	0%,
	to {opacity: 0}
	50% {opacity: 1}
}
@keyframes fade-in-out {
	0%,
	to {opacity: 0}
	50% {opacity: 1}
}
.fade-in-out {
	text-decoration: none;
	animation: fade-in-out 2s ease-in-out infinite alternate;
	-webkit-animation: fade-in-out 2s ease-in-out infinite alternate;
}

@-webkit-keyframes rumble {
	50% {
		-webkit-transform: translateY(-.2em);
		transform: translateY(-.2em)
	}
}
@keyframes rumble {
	50% {
		-webkit-transform: translateY(-.2em);
		transform: translateY(-.2em)
	}
}
.rumble {
	-webkit-animation: rumble linear 0.1s 0s infinite;
	animation: rumble linear 0.1s 0s infinite;
	display:inline-block;
}

@-webkit-keyframes shudder {
	50% {
		-webkit-transform: translateX(0.2em);
		transform: translateX(0.2em)
	}
}
@keyframes shudder {
	50% {
		-webkit-transform: translateX(0.2em);
		transform: translateX(0.2em)
	}
}
.shudder {
	-webkit-animation: shudder linear 0.1s 0s infinite;
	animation: shudder linear 0.1s 0s infinite;
	display: inline-block;
}

@-webkit-keyframes pulse {
	0%  { -webkit-transform: scale(0, 0); transform: scale(0, 0) }
	20% { -webkit-transform: scale(1.2, 1.2); transform: scale(1.2, 1.2) }
	40% { -webkit-transform: scale(0.9, 0.9); transform: scale(0.9, 0.9) }
	60% { -webkit-transform: scale(1.05, 1.05); transform: scale(1.05, 1.05) }
	80% { -webkit-transform: scale(0.925, 0.925); transform:scale(0.925, 0.925) }
	to  { -webkit-transform: scale(1, 1); transform: scale(1, 1) }
}
@keyframes pulse {
	0%  { -webkit-transform: scale(0, 0); transform: scale(0, 0) }
	20% { -webkit-transform: scale(1.2, 1.2); transform: scale(1.2, 1.2) }
	40% { -webkit-transform: scale(0.9, 0.9); transform: scale(0.9, 0.9) }
	60% { -webkit-transform: scale(1.05, 1.05); transform: scale(1.05, 1.05) }
	80% { -webkit-transform: scale(0.925, 0.925); transform: scale(0.925, 0.925) }
	to  { -webkit-transform: scale(1, 1); transform: scale(1, 1) }
}
.pulse {
	-webkit-animation: pulse 0.8s;
	animation: pulse 0.8s;
	display: inline-block;
}

/* Typed.js text (and cursor) styling. */
.typed, .typed-cursor {
	font-family: monospace, monospace;
	color: lime;
}

/* Typed.js animated cursor styling. */
@-webkit-keyframes blink {
	0% { opacity: 1; }
	50% { opacity: 0; }
	100% { opacity: 1; }
}
@-moz-keyframes blink {
	0% { opacity: 1; }
	50% { opacity: 0; }
	100% { opacity: 1; }
}
@keyframes blink {
	0% { opacity: 1; }
	50% { opacity: 0; }
	100% { opacity: 1; }
}
.typed-cursor {
	opacity: 1;
	-webkit-animation: blink 0.7s infinite;
	-moz-animation: blink 0.7s infinite;
	animation: blink 0.7s infinite;
}

div.tcalert {
	background-color: #2F2F2F;
	width: 520px;
    padding: 10px;
    border: 2px solid gray;
    margin: 0;
    margin-left: auto;
    margin-right: auto;
	font-size: 15px;
}
.code {
    font-family: Courier New, Courier, sans-serif;
    border: 1px solid #009900;
    color: #009900;
    background-color: #01091E;
    display: block;
    padding-right: 6px;
    padding-left: 6px;
    padding-top: 2px;
    padding-bottom: 3px;
    margin-left: 12px;
    margin-right: 12px;
    text-align: left;
    white-space: pre;
}

/*
    notify.min.css, by chapel; for use with notify.js
    version 1.0.0
 */
#notify {
    position : fixed;
    display : block;
    width : 16em;
    right : -20em; top : 2em;
    padding : 0.5em;
    background-color : #fff;
    color : #000;
    -webkit-transition : right 0.3s;
    -moz-transition : right 0.3s;
    -o-transition : right 0.3s;
    transition : right 0.3s;
}
#notify.open { right : 0; }

/* Glitchy Text - Start */

/* The "clip" in ".glitch" is depreciated, so technically you should use the "clip-path" that's in ".glitchy" instead, however IE doesn't support "clip-path", and most browsers still support "clip". */

.glitch {
  color: white;
  position: relative;
}
.glitch:before {
  content: attr(data-text);
  width: calc(100% + 0.5em);
  position: absolute;
  left: -9px;
  text-shadow: 1px 0 blue;
  top: -5px;
  color: #FFD;
  background: #111;
  overflow: hidden;
  clip: rect(0, 900px, 0, 0);
  animation: noise-anim-2 3s infinite linear alternate-reverse;
  -webkit-animation: noise-anim-2 3s infinite linear alternate-reverse;
}
.glitch:after {
  content: attr(data-text);
  width: calc(100% + 0.5em);
  position: absolute;
  left: -5px;
  text-shadow: -1px 0 red;
  top: -5px;
  color: #DFF;
  background: #111;
  overflow: hidden;
  clip: rect(0, 900px, 0, 0);
  animation: noise-anim 2s infinite linear alternate-reverse;
  -webkit-animation: noise-anim 2s infinite linear alternate-reverse;
}
@keyframes noise-anim {
  0% {
    clip: rect(80px, 9999px, 16px, 0);
  }
  5% {
    clip: rect(94px, 9999px, 17px, 0);
  }
  10% {
    clip: rect(9px, 9999px, 92px, 0);
  }
  15.0% {
    clip: rect(37px, 9999px, 4px, 0);
  }
  20% {
    clip: rect(53px, 9999px, 47px, 0);
  }
  25% {
    clip: rect(99px, 9999px, 69px, 0);
  }
  30.0% {
    clip: rect(15px, 9999px, 49px, 0);
  }
  35% {
    clip: rect(83px, 9999px, 81px, 0);
  }
  40% {
    clip: rect(55px, 9999px, 43px, 0);
  }
  45% {
    clip: rect(28px, 9999px, 27px, 0);
  }
  50% {
    clip: rect(64px, 9999px, 28px, 0);
  }
  55.0% {
    clip: rect(76px, 9999px, 91px, 0);
  }
  60.0% {
    clip: rect(29px, 9999px, 72px, 0);
  }
  65% {
    clip: rect(70px, 9999px, 10px, 0);
  }
  70% {
    clip: rect(5px, 9999px, 84px, 0);
  }
  75% {
    clip: rect(46px, 9999px, 81px, 0);
  }
  80% {
    clip: rect(7px, 9999px, 85px, 0);
  }
  85.0% {
    clip: rect(17px, 9999px, 89px, 0);
  }
  90% {
    clip: rect(41px, 9999px, 59px, 0);
  }
  95% {
    clip: rect(53px, 9999px, 90px, 0);
  }
  100% {
    clip: rect(10px, 9999px, 30px, 0);
  }
}
@keyframes noise-anim-2 {
  0% {
    clip: rect(84px, 9999px, 3px, 0);
  }
  5% {
    clip: rect(31px, 9999px, 69px, 0);
  }
  10% {
    clip: rect(37px, 9999px, 33px, 0);
  }
  15.0% {
    clip: rect(18px, 9999px, 6px, 0);
  }
  20% {
    clip: rect(25px, 9999px, 87px, 0);
  }
  25% {
    clip: rect(100px, 9999px, 8px, 0);
  }
  30.0% {
    clip: rect(24px, 9999px, 87px, 0);
  }
  35% {
    clip: rect(39px, 9999px, 16px, 0);
  }
  40% {
    clip: rect(96px, 9999px, 25px, 0);
  }
  45% {
    clip: rect(16px, 9999px, 100px, 0);
  }
  50% {
    clip: rect(92px, 9999px, 76px, 0);
  }
  55.0% {
    clip: rect(29px, 9999px, 40px, 0);
  }
  60.0% {
    clip: rect(40px, 9999px, 39px, 0);
  }
  65% {
    clip: rect(94px, 9999px, 44px, 0);
  }
  70% {
    clip: rect(2px, 9999px, 78px, 0);
  }
  75% {
    clip: rect(86px, 9999px, 50px, 0);
  }
  80% {
    clip: rect(2px, 9999px, 46px, 0);
  }
  85.0% {
    clip: rect(41px, 9999px, 71px, 0);
  }
  90% {
    clip: rect(75px, 9999px, 15px, 0);
  }
  95% {
    clip: rect(41px, 9999px, 8px, 0);
  }
  100% {
    clip: rect(23px, 9999px, 75px, 0);
  }
}

.glitchy {
  color: white;
  position: relative;
}
.glitchy:before {
  content: attr(data-text);
  width: calc(100% + 0.5em);
  position: absolute;
  left: -9px;
  text-shadow: 1px 0 blue;
  top: -5px;
  color: #FFD;
  background: #111;
  overflow: hidden;
  clip-path: polygon(0 0);
  animation: noise-animY-2 3s infinite linear alternate-reverse;
  -webkit-animation: noise-animY-2 3s infinite linear alternate-reverse;
}
.glitchy:after {
  content: attr(data-text);
  width: calc(100% + 0.5em);
  position: absolute;
  left: -5px;
  text-shadow: -1px 0 red;
  top: -5px;
  color: #DFF;
  background: #111;
  overflow: hidden;
  clip-path: polygon(0 0);
  animation: noise-animY 2s infinite linear alternate-reverse;
  -webkit-animation: noise-animY 2s infinite linear alternate-reverse;
}
@keyframes noise-animY {
  0% {
    clip-path: polygon(0 80px, 100% 80px, 100% 16px, 0 16px);
  }
  5% {
    clip-path: polygon(0 94px, 100% 94px, 100% 17px, 0 17px);
  }
  10% {
    clip-path: polygon(0 9px, 100% 9px, 100% 92px, 0 92px);
  }
  15.0% {
    clip-path: polygon(0 37px, 100% 37px, 100% 4px, 0 4px);
  }
  20% {
    clip-path: polygon(0 53px, 100% 53px, 100% 47px, 0 47px);
  }
  25% {
    clip-path: polygon(0 99px, 100% 99px, 100% 69px, 0 69px);
  }
  30.0% {
    clip-path: polygon(0 15px, 100% 15px, 100% 49px, 0 49px);
  }
  35% {
    clip-path: polygon(0 83px, 100% 83px, 100% 81px, 0 81px);
  }
  40% {
    clip-path: polygon(0 55px, 100% 55px, 100% 43px, 0 43px);
  }
  45% {
    clip-path: polygon(0 28px, 100% 28px, 100% 27px, 0 27px);
  }
  50% {
    clip-path: polygon(0 64px, 100% 64px, 100% 28px, 0 28px);
  }
  55.0% {
    clip-path: polygon(0 76px, 100% 76px, 100% 91px, 0 91px);
  }
  60.0% {
    clip-path: polygon(0 29px, 100% 29px, 100% 72px, 0 72px);
  }
  65% {
    clip-path: polygon(0 70px, 100% 70px, 100% 10px, 0 10px);
  }
  70% {
    clip-path: polygon(0 5px, 100% 5px, 100% 84px, 0 84px);
  }
  75% {
    clip-path: polygon(0 46px, 100% 46px, 100% 81px, 0 81px);
  }
  80% {
    clip-path: polygon(0 7px, 100% 7px, 100% 85px, 0 85px);
  }
  85.0% {
    clip-path: polygon(0 17px, 100% 17px, 100% 89px, 0 89px);
  }
  90% {
    clip-path: polygon(0 41px, 100% 41px, 100% 59px, 0 59px);
  }
  95% {
    clip-path: polygon(0 53px, 100% 53px, 100% 90px, 0 90px);
  }
  100% {
    clip-path: polygon(0 10px, 100% 10px, 100% 30px, 0 30px);
  }
}
@keyframes noise-animY-2 {
  0% {
    clip-path: polygon(0 84px, 100% 84px, 100% 3px, 0 3px);
  }
  5% {
    clip-path: polygon(0 31px, 100% 31px, 100% 69px, 0 69px);
  }
  10% {
    clip-path: polygon(0 37px, 100% 37px, 100% 33px, 0 33px);
  }
  15.0% {
    clip-path: polygon(0 18px, 100% 18px, 100% 6px, 0 6px);
  }
  20% {
    clip-path: polygon(0 25px, 100% 25px, 100% 87px, 0 87px);
  }
  25% {
    clip-path: polygon(0 100px, 100% 100px, 100% 8px, 0 8px);
  }
  30.0% {
    clip-path: polygon(0 24px, 100% 24px, 100% 87px, 0 87px);
  }
  35% {
    clip-path: polygon(0 39px, 100% 39px, 100% 16px, 0 16px);
  }
  40% {
    clip-path: polygon(0 96px, 100% 96px, 100% 25px, 0 25px);
  }
  45% {
    clip-path: polygon(0 16px, 100% 16px, 100% 100px, 0 100px);
  }
  50% {
    clip-path: polygon(0 92px, 100% 92px, 100% 76px, 0 76px);
  }
  55.0% {
    clip-path: polygon(0 29px, 100% 29px, 100% 40px, 0 40px);
  }
  60.0% {
    clip-path: polygon(0 40px, 100% 40px, 100% 39px, 0 39px);
  }
  65% {
    clip-path: polygon(0 94px, 100% 94px, 100% 44px, 0 44px);
  }
  70% {
    clip-path: polygon(0 2px, 100% 2px, 100% 78px, 0 78px);
  }
  75% {
    clip-path: polygon(0 86px, 100% 86px, 100% 50px, 0 50px);
  }
  80% {
    clip-path: polygon(0 2px, 100% 2px, 100% 46px, 0 46px);
  }
  85.0% {
    clip-path: polygon(0 41px, 100% 41px, 100% 71px, 0 71px);
  }
  90% {
    clip-path: polygon(0 75px, 100% 75px, 100% 15px, 0 15px);
  }
  95% {
    clip-path: polygon(0 41px, 100% 41px, 100% 8px, 0 8px);
  }
  100% {
    clip-path: polygon(0 23px, 100% 23px, 100% 75px, 0 75px);
  }
}
/* Glitchy Text - End */

button[data-balloon]{overflow:visible}[data-balloon]{position:relative;cursor:pointer}[data-balloon]:after{filter:alpha(opacity=0);-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";-moz-opacity:0;-khtml-opacity:0;opacity:0;pointer-events:none;-webkit-transition:all 0.18s ease-out 0.18s;-moz-transition:all 0.18s ease-out 0.18s;-ms-transition:all 0.18s ease-out 0.18s;-o-transition:all 0.18s ease-out 0.18s;transition:all 0.18s ease-out 0.18s;font-family:sans-serif !important;font-weight:normal !important;font-style:normal !important;text-shadow:none !important;font-size:12px !important;background:rgba(17,17,17,0.9);border-radius:4px;color:#fff;content:attr(data-balloon);padding:.5em 1em;position:absolute;white-space:nowrap;z-index:10}[data-balloon]:before{background:no-repeat url("data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http://www.w3.org/2000/svg%22%20width%3D%2236px%22%20height%3D%2212px%22%3E%3Cpath%20fill%3D%22rgba(17,17,17,0.9)%22%20transform%3D%22rotate(0)%22%20d%3D%22M2.658,0.000%20C-13.615,0.000%2050.938,0.000%2034.662,0.000%20C28.662,0.000%2023.035,12.002%2018.660,12.002%20C14.285,12.002%208.594,0.000%202.658,0.000%20Z%22/%3E%3C/svg%3E");background-size:100% auto;width:18px;height:6px;filter:alpha(opacity=0);-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";-moz-opacity:0;-khtml-opacity:0;opacity:0;pointer-events:none;-webkit-transition:all 0.18s ease-out 0.18s;-moz-transition:all 0.18s ease-out 0.18s;-ms-transition:all 0.18s ease-out 0.18s;-o-transition:all 0.18s ease-out 0.18s;transition:all 0.18s ease-out 0.18s;content:'';position:absolute;z-index:10}[data-balloon]:hover:before,[data-balloon]:hover:after,[data-balloon][data-balloon-visible]:before,[data-balloon][data-balloon-visible]:after{filter:alpha(opacity=100);-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)";-moz-opacity:1;-khtml-opacity:1;opacity:1;pointer-events:auto}[data-balloon].font-awesome:after{font-family:FontAwesome}[data-balloon][data-balloon-break]:after{white-space:pre}[data-balloon][data-balloon-blunt]:before,[data-balloon][data-balloon-blunt]:after{-webkit-transition:none;-moz-transition:none;-ms-transition:none;-o-transition:none;transition:none}[data-balloon][data-balloon-pos="up"]:after{bottom:100%;left:50%;margin-bottom:11px;-webkit-transform:translate(-50%, 10px);-moz-transform:translate(-50%, 10px);-ms-transform:translate(-50%, 10px);transform:translate(-50%, 10px);-webkit-transform-origin:top;-moz-transform-origin:top;-ms-transform-origin:top;transform-origin:top}[data-balloon][data-balloon-pos="up"]:before{bottom:100%;left:50%;margin-bottom:5px;-webkit-transform:translate(-50%, 10px);-moz-transform:translate(-50%, 10px);-ms-transform:translate(-50%, 10px);transform:translate(-50%, 10px);-webkit-transform-origin:top;-moz-transform-origin:top;-ms-transform-origin:top;transform-origin:top}[data-balloon][data-balloon-pos="up"]:hover:after,[data-balloon][data-balloon-pos="up"][data-balloon-visible]:after{-webkit-transform:translate(-50%, 0);-moz-transform:translate(-50%, 0);-ms-transform:translate(-50%, 0);transform:translate(-50%, 0)}[data-balloon][data-balloon-pos="up"]:hover:before,[data-balloon][data-balloon-pos="up"][data-balloon-visible]:before{-webkit-transform:translate(-50%, 0);-moz-transform:translate(-50%, 0);-ms-transform:translate(-50%, 0);transform:translate(-50%, 0)}[data-balloon][data-balloon-pos="up-left"]:after{bottom:100%;left:0;margin-bottom:11px;-webkit-transform:translate(0, 10px);-moz-transform:translate(0, 10px);-ms-transform:translate(0, 10px);transform:translate(0, 10px);-webkit-transform-origin:top;-moz-transform-origin:top;-ms-transform-origin:top;transform-origin:top}[data-balloon][data-balloon-pos="up-left"]:before{bottom:100%;left:5px;margin-bottom:5px;-webkit-transform:translate(0, 10px);-moz-transform:translate(0, 10px);-ms-transform:translate(0, 10px);transform:translate(0, 10px);-webkit-transform-origin:top;-moz-transform-origin:top;-ms-transform-origin:top;transform-origin:top}[data-balloon][data-balloon-pos="up-left"]:hover:after,[data-balloon][data-balloon-pos="up-left"][data-balloon-visible]:after{-webkit-transform:translate(0, 0);-moz-transform:translate(0, 0);-ms-transform:translate(0, 0);transform:translate(0, 0)}[data-balloon][data-balloon-pos="up-left"]:hover:before,[data-balloon][data-balloon-pos="up-left"][data-balloon-visible]:before{-webkit-transform:translate(0, 0);-moz-transform:translate(0, 0);-ms-transform:translate(0, 0);transform:translate(0, 0)}[data-balloon][data-balloon-pos="up-right"]:after{bottom:100%;right:0;margin-bottom:11px;-webkit-transform:translate(0, 10px);-moz-transform:translate(0, 10px);-ms-transform:translate(0, 10px);transform:translate(0, 10px);-webkit-transform-origin:top;-moz-transform-origin:top;-ms-transform-origin:top;transform-origin:top}[data-balloon][data-balloon-pos="up-right"]:before{bottom:100%;right:5px;margin-bottom:5px;-webkit-transform:translate(0, 10px);-moz-transform:translate(0, 10px);-ms-transform:translate(0, 10px);transform:translate(0, 10px);-webkit-transform-origin:top;-moz-transform-origin:top;-ms-transform-origin:top;transform-origin:top}[data-balloon][data-balloon-pos="up-right"]:hover:after,[data-balloon][data-balloon-pos="up-right"][data-balloon-visible]:after{-webkit-transform:translate(0, 0);-moz-transform:translate(0, 0);-ms-transform:translate(0, 0);transform:translate(0, 0)}[data-balloon][data-balloon-pos="up-right"]:hover:before,[data-balloon][data-balloon-pos="up-right"][data-balloon-visible]:before{-webkit-transform:translate(0, 0);-moz-transform:translate(0, 0);-ms-transform:translate(0, 0);transform:translate(0, 0)}[data-balloon][data-balloon-pos='down']:after{left:50%;margin-top:11px;top:100%;-webkit-transform:translate(-50%, -10px);-moz-transform:translate(-50%, -10px);-ms-transform:translate(-50%, -10px);transform:translate(-50%, -10px)}[data-balloon][data-balloon-pos='down']:before{background:no-repeat url("data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http://www.w3.org/2000/svg%22%20width%3D%2236px%22%20height%3D%2212px%22%3E%3Cpath%20fill%3D%22rgba(17,17,17,0.9)%22%20transform%3D%22rotate(180 18 6)%22%20d%3D%22M2.658,0.000%20C-13.615,0.000%2050.938,0.000%2034.662,0.000%20C28.662,0.000%2023.035,12.002%2018.660,12.002%20C14.285,12.002%208.594,0.000%202.658,0.000%20Z%22/%3E%3C/svg%3E");background-size:100% auto;width:18px;height:6px;left:50%;margin-top:5px;top:100%;-webkit-transform:translate(-50%, -10px);-moz-transform:translate(-50%, -10px);-ms-transform:translate(-50%, -10px);transform:translate(-50%, -10px)}[data-balloon][data-balloon-pos='down']:hover:after,[data-balloon][data-balloon-pos='down'][data-balloon-visible]:after{-webkit-transform:translate(-50%, 0);-moz-transform:translate(-50%, 0);-ms-transform:translate(-50%, 0);transform:translate(-50%, 0)}[data-balloon][data-balloon-pos='down']:hover:before,[data-balloon][data-balloon-pos='down'][data-balloon-visible]:before{-webkit-transform:translate(-50%, 0);-moz-transform:translate(-50%, 0);-ms-transform:translate(-50%, 0);transform:translate(-50%, 0)}[data-balloon][data-balloon-pos='down-left']:after{left:0;margin-top:11px;top:100%;-webkit-transform:translate(0, -10px);-moz-transform:translate(0, -10px);-ms-transform:translate(0, -10px);transform:translate(0, -10px)}[data-balloon][data-balloon-pos='down-left']:before{background:no-repeat url("data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http://www.w3.org/2000/svg%22%20width%3D%2236px%22%20height%3D%2212px%22%3E%3Cpath%20fill%3D%22rgba(17,17,17,0.9)%22%20transform%3D%22rotate(180 18 6)%22%20d%3D%22M2.658,0.000%20C-13.615,0.000%2050.938,0.000%2034.662,0.000%20C28.662,0.000%2023.035,12.002%2018.660,12.002%20C14.285,12.002%208.594,0.000%202.658,0.000%20Z%22/%3E%3C/svg%3E");background-size:100% auto;width:18px;height:6px;left:5px;margin-top:5px;top:100%;-webkit-transform:translate(0, -10px);-moz-transform:translate(0, -10px);-ms-transform:translate(0, -10px);transform:translate(0, -10px)}[data-balloon][data-balloon-pos='down-left']:hover:after,[data-balloon][data-balloon-pos='down-left'][data-balloon-visible]:after{-webkit-transform:translate(0, 0);-moz-transform:translate(0, 0);-ms-transform:translate(0, 0);transform:translate(0, 0)}[data-balloon][data-balloon-pos='down-left']:hover:before,[data-balloon][data-balloon-pos='down-left'][data-balloon-visible]:before{-webkit-transform:translate(0, 0);-moz-transform:translate(0, 0);-ms-transform:translate(0, 0);transform:translate(0, 0)}[data-balloon][data-balloon-pos='down-right']:after{right:0;margin-top:11px;top:100%;-webkit-transform:translate(0, -10px);-moz-transform:translate(0, -10px);-ms-transform:translate(0, -10px);transform:translate(0, -10px)}[data-balloon][data-balloon-pos='down-right']:before{background:no-repeat url("data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http://www.w3.org/2000/svg%22%20width%3D%2236px%22%20height%3D%2212px%22%3E%3Cpath%20fill%3D%22rgba(17,17,17,0.9)%22%20transform%3D%22rotate(180 18 6)%22%20d%3D%22M2.658,0.000%20C-13.615,0.000%2050.938,0.000%2034.662,0.000%20C28.662,0.000%2023.035,12.002%2018.660,12.002%20C14.285,12.002%208.594,0.000%202.658,0.000%20Z%22/%3E%3C/svg%3E");background-size:100% auto;width:18px;height:6px;right:5px;margin-top:5px;top:100%;-webkit-transform:translate(0, -10px);-moz-transform:translate(0, -10px);-ms-transform:translate(0, -10px);transform:translate(0, -10px)}[data-balloon][data-balloon-pos='down-right']:hover:after,[data-balloon][data-balloon-pos='down-right'][data-balloon-visible]:after{-webkit-transform:translate(0, 0);-moz-transform:translate(0, 0);-ms-transform:translate(0, 0);transform:translate(0, 0)}[data-balloon][data-balloon-pos='down-right']:hover:before,[data-balloon][data-balloon-pos='down-right'][data-balloon-visible]:before{-webkit-transform:translate(0, 0);-moz-transform:translate(0, 0);-ms-transform:translate(0, 0);transform:translate(0, 0)}[data-balloon][data-balloon-pos='left']:after{margin-right:11px;right:100%;top:50%;-webkit-transform:translate(10px, -50%);-moz-transform:translate(10px, -50%);-ms-transform:translate(10px, -50%);transform:translate(10px, -50%)}[data-balloon][data-balloon-pos='left']:before{background:no-repeat url("data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http://www.w3.org/2000/svg%22%20width%3D%2212px%22%20height%3D%2236px%22%3E%3Cpath%20fill%3D%22rgba(17,17,17,0.9)%22%20transform%3D%22rotate(-90 18 18)%22%20d%3D%22M2.658,0.000%20C-13.615,0.000%2050.938,0.000%2034.662,0.000%20C28.662,0.000%2023.035,12.002%2018.660,12.002%20C14.285,12.002%208.594,0.000%202.658,0.000%20Z%22/%3E%3C/svg%3E");background-size:100% auto;width:6px;height:18px;margin-right:5px;right:100%;top:50%;-webkit-transform:translate(10px, -50%);-moz-transform:translate(10px, -50%);-ms-transform:translate(10px, -50%);transform:translate(10px, -50%)}[data-balloon][data-balloon-pos='left']:hover:after,[data-balloon][data-balloon-pos='left'][data-balloon-visible]:after{-webkit-transform:translate(0, -50%);-moz-transform:translate(0, -50%);-ms-transform:translate(0, -50%);transform:translate(0, -50%)}[data-balloon][data-balloon-pos='left']:hover:before,[data-balloon][data-balloon-pos='left'][data-balloon-visible]:before{-webkit-transform:translate(0, -50%);-moz-transform:translate(0, -50%);-ms-transform:translate(0, -50%);transform:translate(0, -50%)}[data-balloon][data-balloon-pos='right']:after{left:100%;margin-left:11px;top:50%;-webkit-transform:translate(-10px, -50%);-moz-transform:translate(-10px, -50%);-ms-transform:translate(-10px, -50%);transform:translate(-10px, -50%)}[data-balloon][data-balloon-pos='right']:before{background:no-repeat url("data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http://www.w3.org/2000/svg%22%20width%3D%2212px%22%20height%3D%2236px%22%3E%3Cpath%20fill%3D%22rgba(17,17,17,0.9)%22%20transform%3D%22rotate(90 6 6)%22%20d%3D%22M2.658,0.000%20C-13.615,0.000%2050.938,0.000%2034.662,0.000%20C28.662,0.000%2023.035,12.002%2018.660,12.002%20C14.285,12.002%208.594,0.000%202.658,0.000%20Z%22/%3E%3C/svg%3E");background-size:100% auto;width:6px;height:18px;left:100%;margin-left:5px;top:50%;-webkit-transform:translate(-10px, -50%);-moz-transform:translate(-10px, -50%);-ms-transform:translate(-10px, -50%);transform:translate(-10px, -50%)}[data-balloon][data-balloon-pos='right']:hover:after,[data-balloon][data-balloon-pos='right'][data-balloon-visible]:after{-webkit-transform:translate(0, -50%);-moz-transform:translate(0, -50%);-ms-transform:translate(0, -50%);transform:translate(0, -50%)}[data-balloon][data-balloon-pos='right']:hover:before,[data-balloon][data-balloon-pos='right'][data-balloon-visible]:before{-webkit-transform:translate(0, -50%);-moz-transform:translate(0, -50%);-ms-transform:translate(0, -50%);transform:translate(0, -50%)}[data-balloon][data-balloon-length='small']:after{white-space:normal;width:80px}[data-balloon][data-balloon-length='medium']:after{white-space:normal;width:150px}[data-balloon][data-balloon-length='large']:after{white-space:normal;width:260px}[data-balloon][data-balloon-length='xlarge']:after{white-space:normal;width:380px}@media screen and (max-width: 768px){[data-balloon][data-balloon-length='xlarge']:after{white-space:normal;width:90vw}}[data-balloon][data-balloon-length='fit']:after{white-space:normal;width:100%}
















































</style><script role="script" id="twine-user-script" type="text/twine-javascript">(function () {
    $(document).on('keyup', function (ev) {
        if (ev.key === 'Enter') {
					if (State.getVar("$acmd") != "") {
          	  Wikifier.wikifyEval('<<include "commandparser">>');
			 		} else {
			 			Wikifier.wikifyEval("<<dialog 'aOS CMD'>><<include 'commandinput'>><</dialog>>");
					}
        }
			  if (ev.key === 'Escape') {
					Dialog.close()
        }
    });
}());

// If flag exists then return value, else return false
window.Flag = function (Fnam) {
	if (State.variables.Flags == undefined) {
		State.variables.Flags = {};
	} else if (State.variables.Flags[Fnam.toLowerCase()] !== undefined) {
		return State.variables.Flags[Fnam.toLowerCase()];
	};
	return false;
};

window.reloadPassage = function () {
	var prev = passage();
	return Wikifier.wikifyEval('<<goto [['+prev+']]>>');
}

window.goBack = function () {
	var prev = previous();
	return Wikifier.wikifyEval('<<goto [['+prev+']]>>');
}

window.hasEnergy = function (limit) {
	var curen = State.getVar("$character.en");
	return Number(curen) >= Number(limit);
}

Macro.add('percent', {
		handler: function(){
			var res = ((100 * this.args[0]) / this.args[1]);
			var res = res+"%"
			jQuery(this.output).wiki(res);
			return res
		}
});
					
var toggleMature = function () {
	if (settings.mature) { // is true
		State.setVar("$mature", true)
		Wikifier.wikifyEval('<<notify>>The world becomes a darker place.<</notify>>');
	}
	else { // is false
		State.setVar("$mature", false)
		Wikifier.wikifyEval('<<notify>>The world feels cleaner.<</notify>>');
	}
};

var toggleMusic = function () {
	if (settings.music) { // is true
		State.setVar("$music", true)
		Wikifier.wikifyEval('<<notify>>You hear the world again.<</notify>>');
	}
	else { // is false
		State.setVar("$music", false)
		Wikifier.wikifyEval('<<audio ":playing" stop>>');
		Wikifier.wikifyEval('<<notify>>Suddenly the world went quiet.<</notify>>');
	}
};

Setting.addToggle("mature", {
	label : "Content for mature audiences?",
	onChange : toggleMature
});

Setting.addToggle("music", {
	label 		: "Play music ingame?",
	default		: true,
	onChange 	: toggleMusic
});

Config.saves.isAllowed = function () {
	return tags().contains("savable");
};

postdisplay['hidden-link-setup'] = function () {
    /*
        Hidden links that are always hidden:
            <span class="hidden">[[A hidden link]]</span>
    */
    $('.hidden')
        .addClass('hidden');

    /*
        Hidden links that hide unless you're hovering over them:
            <span class="hides">[[A hidden link]]</span>
    */
    $('.hides')
        .addClass('hidden')
        .on('mouseenter', function () {
            $(this).removeClass('hidden');
        })
        .on('mouseleave', function () {
            $(this).addClass('hidden');
        });

    /*
        Hidden links that reveal themselves when you hover over them:
            <span class="reveals">[[A hidden link]]</span>
    */
    $('.reveals')
        .addClass('hidden')
        .one('mouseenter', function () {
            $(this).removeClass('hidden');
        });
};

// operations, by chapel; for sugarcube 2.x
// v1.0.0
// adds a dice roller and 'fairmath'

// options object
setup.operations = {
    tryGlobal : true, 
    nicknames : true, 
    fmRange   : [0, 100]
};

/*

    I couldn't decide on which syntax mode was best, expecially for dice.
    So I wound up including a bunch of options, and they all work essentially the same way.
    Though the dice 'parser' [e.g. dice('string')] syntax and the shortcuts [e.g. x.fm(), x.d()]
    perform slightly worse / are slightly slower than the other potential syntax modes.

    Supported syntax:
        1. the dice roller: (all the following work and are all equivalent to '3d6+10')
            a. dice(3, 6) + 10
            b. dice('3d6 + 10')
            c. dice('3d6+10')
            d. dice('3d6') + 10
            e. (3).dice(6) + 10
            f. (3).d(6) + 10
            g. !!! dice('3d6' + 10) -- Will roll 3 610-sided dice; the parser can't accept mixed arguments
        2. the fairmath system (based on the ChoiceScript stats system)
            a. (100).fairmath(-20)  [=80]
            b. (90).fm(20)          [=92]
            c. Math.fm(50, 40)      [=70]
            d. Math.fairmath(0, 10) [=10]
        3. Notes.
            a. dice() is also available as setup.dice.roll()
            b. you only need to use parens on bare numbers, none are required for variables
            c. be careful! rolling dice with floating point numbers or negatives will cause errors
            d. likewise, fairmath will spit out errors if it's given bizarre numbers
    
    Options:
        tryGlobal : sends setup.dice.roll() to the global scope as dice() if true
        nicknames : include the shorter method calls [Math.fm(), <number>.fm(), and <number>.d()]
        fmRange   : move the minimum and maximum range for the fairmath system, if you need to
                    note that the results are constrained by this range, but can never actually hit it
                    that is, [0, 100] will limit the actual numbers to 1-99, 
                    [10, 45] would limit the results to 11-44, etc.
        
*/

/*                  DICE                    */

// dice helpers
setup.dice = {
    processDice : function (a, b) {
        // find the number of dice and the type of die
        var roll = [], i, result = 0;
        if (typeof a === 'string') {
            roll = a.split('d');
        } else if (typeof a === 'number' && b) {
            roll = [a, b];
        } else if (Array.isArray(a) && a.length >= 2) {
            a.length = 2;
            roll = a;
        } else {
            throw new TypeError('setup.dice.processDice(): could not process arguments...');
        }
        for (i = 0; i < roll[0]; i++) {
            /*
                we're going to roll each die.  we could generate a number
                between the max and min possible simply enough,
                but real dice have weights -- rolling 3d6 is far more likely to result 
                in 10 or 11 than in 3 or 18, and pure randomization will not emulate this
            */
            var die = 0;
            die = Math.floor(Math.random() * roll[1]) + 1;
            result += die; // update result
        }
        return result; // this prelimary result ignores modifiers; it only rolls the dice
    },
    processString : function (string) {
        // recieves strings like '1d6 + 6' or 1d20+3'
        var parsed = [];
        // remove all whitespace and trim
        string = string.trim().replace(/\s/g, '');
        // check for and return the parts of the roll (2 chunks: '1d6' and '+6')
        parsed = string.match(/(\d*d\d*)(.*)/);
        return [parsed[1], Number(parsed[2])]; // send the data off as an array
    },
    roll : function (a, b) {
        if (typeof a === 'string') {
            var result = setup.dice.processString(a);
            /* 
                the expression below rolls the dice and adds the modifier, 
                which must be additive (i.e. +5 or -5, but never *5)
            */
            return setup.dice.processDice(result[0]) + result[1];
        } else {
            // just run it, it'll toss out its own errors
            return setup.dice.processDice(a, b);
        }
    }
};

// global dice() function; dice('[x]d[y] +/- [z]') -or- dice(2, 10) [2d10]
// ex. $var = dice('2d10+5'); _var = dice('3d6 - 1'); _var = dice(3, 6) + 10; etc
if (setup.operations.tryGlobal) { // test options
    window.dice = window.dice || setup.dice.roll; 
}
// send to global scope without breaking anything
// always available via setup.dice.roll() when unavailable here

// dice method; Number.prototype.dice(number)
// ex. (1).dice(6) + 10; $roll = $die.number.dice($die.type); etc
if (!Number.prototype.dice) {
    Object.defineProperty(Number.prototype, 'dice', {
        configurable : true,
        writable     : true,
        
        value : function (val) {
            // errors and weirdness
            if (this === 0) {
                return 0;
            } 
            if (this < 0) {
                throw new TypeError('Number.prototype.dice: cannot roll a negative number of dice!');
            }
            if (val == null || typeof val != 'number' || val <= 0 || arguments.length < 1) {
                throw new TypeError('Number.prototype.dice: error in argument');
            }
            if (!Number.isInteger(this) || !Number.isInteger(val)) {
                throw new TypeError('Number.prototype.dice: cannot roll partial dice!');
            }
            
            // call the dice processing function
            return setup.dice.processDice(this, val);
        }
    });
}

/*                  FAIRMATH                */

// fairmath method; Number.prototype.fairmath(value)
// ex. (20).fairmath(30); $var = $var.fairmath(-10); etc 
if (!Number.prototype.fairmath) {
    Object.defineProperty(Number.prototype, 'fairmath', {
        configurable : true,
        writable     : true,
        
        value : function (val) {
            // errors
            var op = setup.operations.fmRange;
            
            if (this < op[0] || this > op[1]) {
                throw new TypeError('Number.prototype.fairmath called on a number that is out of the defined range (the number was ' + this + ').');
            }
            if (val == null || typeof val != 'number' || val > 100 || val < -100 || arguments.length < 1) {
                throw new TypeError('Number.prototype.fairmath given incorrect argument or an argument that is out of the valid 0-100 range.');
            }
            
            // do the 'fair' math!
            if (val === 0) { // a 0 increase or decrease; just trunc and clamp
                return Math.clamp(Math.trunc(this), op[0], op[1]);
            }
            if (val < 0) { // number is negative, representing a decrease
                val = val * -1; // make positive for the math below
                return Math.clamp(Math.trunc(
                    this - ((this - op[0]) * (val / op[1]))
                ), op[0], op[1]);
            }
            if (val > 0) { // number is positive, represeting an increase
                return Math.clamp(Math.trunc(
                    this + ((op[1] - this) * (val / op[1]))
                ), op[0], op[1]);
            }
            // something inexplicable happened
            throw new Error('Number.prototype.fairmath encountered an unspecified error.');
        }
    });
}

// Math.fairmath() method 
if (!Math.fairmath) {
    Object.defineProperty(Math, 'fairmath', {
        configurable : true,
        writable     : true,
        
        value : function (base, val) { 
            return base.fairmath(val);
        }
    });
}

/*                  EXTRAS                  */

// now for some shortcuts
if (setup.operations.nicknames) {
    if (!Math.fm) { // Math.fm()
        Object.defineProperty(Math, 'fm', {
            configurable : true,
            writable     : true,
            
            value : function (base, val) { 
                return base.fairmath(val);
            }
        });
    }
    if (!Number.prototype.fm) { // <number>.fm()
        Object.defineProperty(Number.prototype, 'fm', {
            configurable : true,
            writable     : true,
            
            value : function (val) { 
                return this.fairmath(val);
            }
        });
    }
    if (!Number.prototype.d) { // <number>.d()
        Object.defineProperty(Number.prototype, 'd', {
            configurable : true,
            writable     : true,
        
            value : function (val) { 
                return this.dice(val);
            }
        });
    }
}
// mouseover.min.js, for SugarCube 2, by Chapel
;Macro.add("mouseover",{tags:["onhover","onmouseover","onmousein","onmouseenter","onmouseout"],skipArgs:!0,handler:function(){if(this.payload.length<2)return this.error("No event tag used.");var e={mouseover:[],mousein:[],mouseout:[]},o=$(document.createElement("span")).addClass("macro-"+this.name).wiki(this.payload[0].contents).appendTo(this.output);this.payload.forEach(function(o){switch(o.name){case"onhover":case"onmouseover":e.mouseover.push(o.contents);break;case"onmousein":case"onmouseenter":e.mousein.push(o.contents);break;case"onmouseout":e.mouseout.push(o.contents);break;default:return}}),e.mouseover.length&&o.on("mouseover",function(o){$.wiki(e.mouseover.join(" "))}),e.mousein.length&&o.on("mouseenter",function(o){$.wiki(e.mousein.join(" "))}),e.mouseout.length&&o.on("mouseout",function(o){$.wiki(e.mouseout.join(" "))})}});
// end mouseover.min.js


// notify.js, by chapel; for sugarcube 2
// version 1.0.0
// requires notify.css / notify.min.css

$(document.body).append("<div id='notify'></div>");
$(document).on(':notify', function (e) {
    if (e.message && typeof e.message === 'string') {
        // trim message
        e.message.trim();
        // classes
        if (e.class) {
            if (typeof e.class === 'string') {
                e.class = 'open macro-notify ' + e.class;
            } else if (Array.isArray(e.class)) {
                e.class = 'open macro-notify ' + e.class.join(' ');
            } else {
                e.class = 'open macro-notify';
            }
        } else {
            e.class = 'open macro-notify';
        }
        
        // delay
        if (e.delay) {
            if (typeof e.delay !== 'number') {
                e.delay = Number(e.delay)
            }
            if (Number.isNaN(e.delay)) {
                e.delay = 2000;
            }
        } else {
            e.delay = 2000;
        }
        
        $('#notify')
            .empty()
            .wiki(e.message)
            .addClass(e.class)
                
        setTimeout(function () {
            $('#notify').removeClass();
        }, e.delay);
    }
});

// <<notify delay 'classes'>> message <</notify>>
Macro.add('notify', {
       tags : null,
    handler : function () {
        
        // set up
        var msg     = this.payload[0].contents, 
            time    = false, 
            classes = false, i;
        
        // arguments
        if (this.args.length > 0) {
            if (typeof this.args[0] === 'number') {
                time    = this.args[0];
                classes = (this.args.length > 1) ? this.args.slice(1).flatten() : false;
            } else {
                classes = this.args.flatten().join(' ');
            }
        }
        
        // fire event
        $(document).trigger({
            type    : ':notify',
            message : msg,
            delay   : time,
            class   : classes
        });
        
    }
});

// dialog API macro set, by chapel; for sugarcube 2
// version 1.2.0
// see the documentation: https://github.com/ChapelR/custom-macros-for-sugarcube-2#dialog-api-macros

// <<dialog>> macro
Macro.add('dialog', {
       tags : null,
    handler : function () {
        
        // handle args (if any)
        var content = (this.payload[0].contents) ? this.payload[0].contents : '';
        var title = (this.args.length > 0) ? this.args[0] : '';
        var classes = (this.args.length > 1) ? this.args.slice(1).flatten() : [];
        
        // add the macro- class
        classes.push('macro-' + this.name);
        
        // dialog box
        Dialog.setup(title, classes.join(' '));
        Dialog.wiki(content);
        Dialog.open();
        
    }

});

// <<popup>> macro
Macro.add('popup', {
    handler : function () {
        
        // errors
        if (this.args.length < 1) {
            return this.error('need at least one argument; the passage to display');
        }
        if (!Story.has(this.args[0])) {
            return this.error('the passage ' + this.args[0] + 'does not exist');
        }
        
        // passage name and title
        var psg   = this.args[0];
        var title = (this.args.length > 1) ? this.args[1] : '';
        var classes = (this.args.length > 2) ? this.args.slice(2).flatten() : [];
        
        // add the macro- class
        classes.push('macro-' + this.name);
        
        // dialog box
        Dialog.setup(title, classes.join(' '));
        Dialog.wiki(Story.get(psg).processText());
        Dialog.open();
        
    }

});

// simple-inventory.min.js, for SugarCube 2, by Chapel
;setup.simpleInv={},setup.simpleInv.options={tryGlobal:!0,defaultStrings:{empty:"The inventory is empty...",listDrop:"Discard",separator:"\n"}},setup.simpleInv.attachEvent=function(i,t,n,r){$(document).trigger({type:"initialized"===r?":inventory-init":":inventory-update",instance:i,receiving:t,moved:n,context:r})},setup.simpleInv.inventory=function(i){"use strict";if(i=i?(i=[].slice.call(arguments)).flatten():[],!(this instanceof setup.simpleInv.inventory))return new setup.simpleInv.inventory(i);i=(this.inv=i).length?i:null,setup.simpleInv.attachEvent(this,null,i,"initialized")},setup.simpleInv.inventory.is=function(i){return i instanceof setup.simpleInv.inventory},setup.simpleInv.inventory.log=function(i){return setup.simpleInv.inventory.is(i)?"Inventory.log() -> "+i.toArray().join(" - "):"Inventory.log() -> object is not an inventory..."},setup.simpleInv.inventory.removeDuplicates=function(i){if(setup.simpleInv.inventory.is(i)){var t,n=i.toArray();return t=[],n.forEach(function(i){t.includes(i)||t.push(i)}),t}},setup.simpleInv.inventory.getUID=function(i,t){var n=Math.random().toString(36).substring(7);return arguments.length<2&&(i=Math.random().toString(36).substring(7),t=random(99)),"simple-inv-"+t+"-"+Date.now()+"-"+i.replace(/[^A-Za-z0-9]/g,"")+"-"+n},setup.simpleInv.inventory.prototype={transfer:function(i){if(arguments.length<2)return this;if(!(i instanceof setup.simpleInv.inventory))return this;for(var t=[].slice.call(arguments),n=[],r=0,e=(t=t.slice(1).flatten()).length;r<e;r++)this.inv.includes(t[r])&&(this.inv.delete(t[r]),n.push(t[r]));return n.length&&(i.inv=i.inv.concat(n),setup.simpleInv.attachEvent(this,i,n,"transfer")),this},has:function(){var i=[].slice.call(arguments).flatten();return!(!i||!i.length)&&this.inv.includesAny(i)},hasAll:function(){var i=[].slice.call(arguments).flatten();return!(!i||!i.length)&&this.inv.includesAll(i)},pickUp:function(i){var t,n=[].slice.call(arguments).flatten(),r=this;return n&&n.length&&("unique"!==i&&"unique"!==n[0]||(n=n.splice(1),t=[],n.forEach(function(i){r.inv.includes(i)||t.includes(i)||t.push(i)}),n=t),this.inv=this.inv.concat(n),setup.simpleInv.attachEvent(this,null,n,"pickup")),this},drop:function(){var t,i=[].slice.call(arguments).flatten(),n=this;if(i&&i.length){var r=[];i.forEach(function(i){n.has(i)&&(r.push(i),t=n.inv.indexOf(i),n.inv.deleteAt(t))}),setup.simpleInv.attachEvent(this,null,r,"drop")}return this},sort:function(){return this.inv=this.inv.sort(),setup.simpleInv.attachEvent(this,null,null,"sort"),this},show:function(i){return i&&"string"==typeof i||(i=setup.simpleInv.options.defaultStrings.separator),this.inv.length?this.inv.join(i):setup.simpleInv.options.defaultStrings.empty},empty:function(){var i=clone(this.inv);return this.inv=[],setup.simpleInv.attachEvent(this,null,i,"drop"),this},toArray:function(){return this.inv},count:function(t){if(t&&"string"==typeof t){var n=0;return this.toArray().forEach(function(i){i===t&&n++}),n}return this.toArray().length},isEmpty:function(){return 0===this.toArray().length},linkedList:function(o,l){o&&o instanceof setup.simpleInv.inventory||(o=!1);var i=this.toArray(),u=this,v=$(document.createElement("span"));return i&&i.length?i.forEach(function(i,t,n){var r=$(document.createElement("span")),e=$(document.createElement("a")),s=l||setup.simpleInv.options.defaultStrings.drop,a=setup.simpleInv.inventory.getUID(i,t);e.wiki(s).addClass("simple-inv drop-link"),e.ariaClick(function(){o?u.transfer(o,i):u.drop(i),$("#"+a).empty()}),r.attr("id",a).addClass("simple-inv link-listing").wiki(i+" ").append(e),t<n.length-1&&r.wiki("<br />"),v.append(r)}):v.wiki(setup.simpleInv.options.defaultStrings.empty),v},constructor:setup.simpleInv.inventory,toJSON:function(){return JSON.reviveWrapper("new setup.simpleInv.inventory("+JSON.stringify(this.inv)+")")},clone:function(){return new setup.simpleInv.inventory(this.inv)}},setup.simpleInv.options.tryGlobal&&(window.Inventory=window.Inventory||setup.simpleInv.inventory),Macro.add("newinventory",{handler:function(){if(this.args.length<1)return this.error("incorrect number of arguments");var i=this.args[0].trim();if("$"!==i[0]&&"_"!==i[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');Wikifier.setValue(i,new setup.simpleInv.inventory(this.args.slice(1).flatten()))}}),Macro.add("pickup",{handler:function(){if(this.args.length<2)return this.error("incorrect number of arguments");var i=this.args[0].trim();if("$"!==i[0]&&"_"!==i[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var t=Wikifier.getValue(i);if(!setup.simpleInv.inventory.is(t))return this.error("variable "+i+" is not an inventory!");t.pickUp(this.args.slice(1).flatten())}}),Macro.add("drop",{handler:function(){if(this.args.length<2)return this.error("incorrect number of arguments");var i=this.args[0].trim();if("$"!==i[0]&&"_"!==i[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var t=Wikifier.getValue(i);if(!setup.simpleInv.inventory.is(t))return this.error("variable "+i+" is not an inventory!");t.drop(this.args.slice(1).flatten())}}),Macro.add("transfer",{handler:function(){if(this.args.length<3)return this.error("incorrect number of arguments");var i=this.args[0].trim();if("$"!==i[0]&&"_"!==i[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var t=Wikifier.getValue(i);if(!setup.simpleInv.inventory.is(t))return this.error("variable "+i+" is not an inventory!");var n=this.args[1].trim();if("$"!==n[0]&&"_"!==n[0])return this.error('variable name "'+this.args[1]+'" is missing its sigil ($ or _)');var r=Wikifier.getValue(n);if(!setup.simpleInv.inventory.is(r))return this.error("variable "+n+" is not an inventory!");t.transfer(r,this.args.slice(2).flatten())}}),Macro.add("dropall",{handler:function(){if(1!==this.args.length)return this.error("incorrect number of arguments");var i=this.args[0].trim();if("$"!==i[0]&&"_"!==i[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var t=Wikifier.getValue(i);if(!setup.simpleInv.inventory.is(t))return this.error("variable "+i+" is not an inventory!");t.empty()}}),Macro.add("clear","dropall",!1),Macro.add("sort",{handler:function(){if(1!==this.args.length)return this.error("incorrect number of arguments");var i=this.args[0].trim();if("$"!==i[0]&&"_"!==i[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var t=Wikifier.getValue(i);if(!setup.simpleInv.inventory.is(t))return this.error("variable "+i+" is not an inventory!");t.sort()}}),Macro.add("inventory",{handler:function(){if(this.args.length<1||2<this.args.length)return this.error("incorrect number of arguments");var i=this.args[0].trim();if("$"!==i[0]&&"_"!==i[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var t=Wikifier.getValue(i);if(!setup.simpleInv.inventory.is(t))return this.error("variable "+i+" is not an inventory!");var n=$(document.createElement("span")),r=!!this.args[1]&&this.args[1];n.wiki(t.show(r)).addClass("macro-"+this.name).appendTo(this.output)}}),Macro.add("linkedinventory",{handler:function(){if(this.args.length<2||3<this.args.length)return this.error("incorrect number of arguments");var i=!1,t=this.args[1].trim(),n="string"==typeof this.args[0]&&this.args[0];if(!n)return this.error("first argument should be the link text");if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[1]+'" is missing its sigil ($ or _)');var r=Util.slugify(t);r=this.name+"-"+r;var e=Wikifier.getValue(t);if(!setup.simpleInv.inventory.is(e))return this.error("variable "+t+" is not an inventory!");if(2<this.args.length){var s=this.args[2].trim();if("$"!==s[0]&&"_"!==s[0])return this.error('variable name "'+this.args[2]+'" is missing its sigil ($ or _)');if(i=Wikifier.getValue(s),!setup.simpleInv.inventory.is(i))return this.error("variable "+s+" is not an inventory!")}e.linkedList(i,n).attr("id",r).addClass("macro-"+this.name).appendTo(this.output)}});
// end simple-inventory.min.js

// ui-macro.min.js, for SugarCube 2, by Chapel
;!function(){var a={update:UIBar.setStoryElements,stow:UIBar.stow,unstow:UIBar.unstow,toggle:function(){$("#ui-bar").hasClass("stowed")?UIBar.unstow():UIBar.stow()},hide:function(){$("#ui-bar").css("display","none")},show:function(){$("#ui-bar").css("display","block")},kill:function(){$("#ui-bar").css("display","none"),$("#story").css("margin-left","2.5em")},restore:function(){$("#ui-bar").css("display","block"),$("#story").css("margin-left","20em")},jump:UI.jumpto,saves:UI.saves,restart:UI.restart,settings:UI.settings,share:UI.share,aliases:{refresh:"update",reload:"update",destroy:"kill",revive:"restore",jumpto:"jump",save:"saves",load:"saves",setting:"settings",sharing:"share"}},e=Object.keys(a);function t(s){return s&&"string"==typeof s?(s=s.toLowerCase().trim(),t=s,e.includes(t)||(r=s,s=a.aliases[r]||null)?(a[s](),!1):'Command "'+s+'" is not a valid command.'):"Command is not a string.";var r,t}Macro.add("ui",{handler:function(){Array.isArray(this.args)&&this.args.length||this.error("No commands passed to macro.");var s,r=function(s){if(!Array.isArray(s))return"Command list error.";var r=[];return s.forEach(function(s){r.push(t(s))}),r}(this.args.flatten());s=(r=r.filter(function(s){return"string"==typeof s})).join(" "),r.length&&s&&this.error(s)}})}();
// end ui-macro.min.js

// message-macro.min.js, for SugarCube 2, by Chapel
;setup.messageMacro={},setup.messageMacro.default="Help",Macro.add("message",{tags:null,handler:function(){var e=this.payload[0].contents,a=$(document.createElement("span")),s=$(document.createElement(this.args.includes("btn")?"button":"a")),t=$(document.createElement("span"));s.wiki(0<this.args.length&&"btn"!==this.args[0]?this.args[0]:setup.messageMacro.default).ariaClick(function(){a.hasClass("open")?t.css("display","none").empty():t.css("display","block").wiki(e),a.toggleClass("open")}),a.attr("id","macro-"+this.name+"-"+this.args.join("").replace(/[^A-Za-z0-9]/g,"")).addClass("message-text").append(s).append(t).appendTo(this.output)}});
// end message-macro.min.js

/*! typed.js integration module for SugarCube */
!function(){"use strict";function getInlineOptions(classNames){var options={},typedRe=/^typed(?:-(\w+))+\b$/,parseRe=/-(speed|delay)(\d+)\b/g,match=void 0;if("typed"!==classNames)for(var classOpts=classNames.toLowerCase().split(/\s+/),i=0;i<classOpts.length;++i)if(typedRe.test(classOpts[i])){for(;null!==(match=parseRe.exec(classOpts[i]));)switch(match[1]){case"speed":options.typeSpeed=Number(match[2]);break;case"delay":options.startDelay=Number(match[2])}break}return options}function typedCallbackFactory(el,callback){return function(){var $outer=jQuery(el),$inner=jQuery('<div class="typedjs-text-wrapper" style="display:block;position:absolute;left:0;top:0;"><span class="typed"></span></div>'),$source=$outer.children('[class|="typed"]'),options=jQuery.extend({strings:["^0 "+$source.html()],typeSpeed:40,startDelay:400,onComplete:function(){$inner.children(".typed-cursor").remove(),callback()},preStringTyped:function(){jQuery.event.trigger(":typedstart")},onStringTyped:function(){jQuery.event.trigger(":typedstop")}},getInlineOptions($source.attr("class")));$outer.append($inner),new Typed($inner.children()[0],options)}}postrender[":typedSetupHandler"]=function(content){jQuery(content).find('[class|="typed"]').addClass("typed").css("visibility","hidden").wrap('<div class="typedjs-outer-wrapper" style="display:block;position:relative;"></div>')},postdisplay[":typedAnimationHandler"]=function(){var $elements=jQuery("#passages .typedjs-outer-wrapper");if(0!==$elements.length){for(var callback=function(){jQuery.event.trigger(":typedcomplete")},i=$elements.length-1;i>=0;--i)callback=typedCallbackFactory($elements[i],callback);callback()}}}();
!function(){(function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Typed=e():t.Typed=e()})(this,function(){return function(t){function e(n){if(s[n])return s[n].exports;var i=s[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var s={};return e.m=t,e.c=s,e.p="",e(0)}([function(t,e,s){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}(),r=s(1),o=s(3),a=function(){function t(e,s){n(this,t),r.initializer.load(this,s,e),this.begin()}return i(t,[{key:"toggle",value:function(){this.pause.status?this.start():this.stop()}},{key:"stop",value:function(){this.typingComplete||this.pause.status||(this.toggleBlinking(!0),this.pause.status=!0,this.options.onStop(this.arrayPos,this))}},{key:"start",value:function(){this.typingComplete||this.pause.status&&(this.pause.status=!1,this.pause.typewrite?this.typewrite(this.pause.curString,this.pause.curStrPos):this.backspace(this.pause.curString,this.pause.curStrPos),this.options.onStart(this.arrayPos,this))}},{key:"destroy",value:function(){this.reset(!1),this.options.onDestroy(this)}},{key:"reset",value:function(){var t=arguments.length<=0||void 0===arguments[0]||arguments[0];clearInterval(this.timeout),this.replaceText(""),this.cursor&&this.cursor.parentNode&&(this.cursor.parentNode.removeChild(this.cursor),this.cursor=null),this.strPos=0,this.arrayPos=0,this.curLoop=0,t&&(this.insertCursor(),this.options.onReset(this),this.begin())}},{key:"begin",value:function(){var t=this;this.typingComplete=!1,this.shuffleStringsIfNeeded(this),this.insertCursor(),this.bindInputFocusEvents&&this.bindFocusEvents(),this.timeout=setTimeout(function(){t.currentElContent&&0!==t.currentElContent.length?t.backspace(t.currentElContent,t.currentElContent.length):t.typewrite(t.strings[t.sequence[t.arrayPos]],t.strPos)},this.startDelay)}},{key:"typewrite",value:function(t,e){var s=this;this.fadeOut&&this.el.classList.contains(this.fadeOutClass)&&(this.el.classList.remove(this.fadeOutClass),this.cursor&&this.cursor.classList.remove(this.fadeOutClass));var n=this.humanizer(this.typeSpeed),i=1;return this.pause.status===!0?void this.setPauseStatus(t,e,!0):void(this.timeout=setTimeout(function(){e=o.htmlParser.typeHtmlChars(t,e,s);var n=0,r=t.substr(e);if("^"===r.charAt(0)&&/^\^\d+/.test(r)){var a=1;r=/\d+/.exec(r)[0],a+=r.length,n=parseInt(r),s.temporaryPause=!0,s.options.onTypingPaused(s.arrayPos,s),t=t.substring(0,e)+t.substring(e+a),s.toggleBlinking(!0)}if("`"===r.charAt(0)){for(;"`"!==t.substr(e+i).charAt(0)&&(i++,!(e+i>t.length)););var u=t.substring(0,e),l=t.substring(u.length+1,e+i),c=t.substring(e+i+1);t=u+l+c,i--}s.timeout=setTimeout(function(){s.toggleBlinking(!1),e===t.length?s.doneTyping(t,e):s.keepTyping(t,e,i),s.temporaryPause&&(s.temporaryPause=!1,s.options.onTypingResumed(s.arrayPos,s))},n)},n))}},{key:"keepTyping",value:function(t,e,s){0===e&&(this.toggleBlinking(!1),this.options.preStringTyped(this.arrayPos,this)),e+=s;var n=t.substr(0,e);this.replaceText(n),this.typewrite(t,e)}},{key:"doneTyping",value:function(t,e){var s=this;this.options.onStringTyped(this.arrayPos,this),this.toggleBlinking(!0),this.arrayPos===this.strings.length-1&&(this.complete(),this.loop===!1||this.curLoop===this.loopCount)||(this.timeout=setTimeout(function(){s.backspace(t,e)},this.backDelay))}},{key:"backspace",value:function(t,e){var s=this;if(this.pause.status===!0)return void this.setPauseStatus(t,e,!0);if(this.fadeOut)return this.initFadeOut();this.toggleBlinking(!1);var n=this.humanizer(this.backSpeed);this.timeout=setTimeout(function(){e=o.htmlParser.backSpaceHtmlChars(t,e,s);var n=t.substr(0,e);if(s.replaceText(n),s.smartBackspace){var i=s.strings[s.arrayPos+1];i&&n===i.substr(0,e)?s.stopNum=e:s.stopNum=0}e>s.stopNum?(e--,s.backspace(t,e)):e<=s.stopNum&&(s.arrayPos++,s.arrayPos===s.strings.length?(s.arrayPos=0,s.options.onLastStringBackspaced(),s.shuffleStringsIfNeeded(),s.begin()):s.typewrite(s.strings[s.sequence[s.arrayPos]],e))},n)}},{key:"complete",value:function(){this.options.onComplete(this),this.loop?this.curLoop++:this.typingComplete=!0}},{key:"setPauseStatus",value:function(t,e,s){this.pause.typewrite=s,this.pause.curString=t,this.pause.curStrPos=e}},{key:"toggleBlinking",value:function(t){if(this.cursor&&!this.pause.status&&this.cursorBlinking!==t){this.cursorBlinking=t;var e=t?"infinite":0;this.cursor.style.animationIterationCount=e}}},{key:"humanizer",value:function(t){return Math.round(Math.random()*t/2)+t}},{key:"shuffleStringsIfNeeded",value:function(){this.shuffle&&(this.sequence=this.sequence.sort(function(){return Math.random()-.5}))}},{key:"initFadeOut",value:function(){var t=this;return this.el.className+=" "+this.fadeOutClass,this.cursor&&(this.cursor.className+=" "+this.fadeOutClass),setTimeout(function(){t.arrayPos++,t.replaceText(""),t.strings.length>t.arrayPos?t.typewrite(t.strings[t.sequence[t.arrayPos]],0):(t.typewrite(t.strings[0],0),t.arrayPos=0)},this.fadeOutDelay)}},{key:"replaceText",value:function(t){this.attr?this.el.setAttribute(this.attr,t):this.isInput?this.el.value=t:"html"===this.contentType?this.el.innerHTML=t:this.el.textContent=t}},{key:"bindFocusEvents",value:function(){var t=this;this.isInput&&(this.el.addEventListener("focus",function(e){t.stop()}),this.el.addEventListener("blur",function(e){t.el.value&&0!==t.el.value.length||t.start()}))}},{key:"insertCursor",value:function(){this.showCursor&&(this.cursor||(this.cursor=document.createElement("span"),this.cursor.className="typed-cursor",this.cursor.innerHTML=this.cursorChar,this.el.parentNode&&this.el.parentNode.insertBefore(this.cursor,this.el.nextSibling)))}}]),t}();e["default"]=a,t.exports=e["default"]},function(t,e,s){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},o=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}(),a=s(2),u=n(a),l=function(){function t(){i(this,t)}return o(t,[{key:"load",value:function(t,e,s){if("string"==typeof s?t.el=document.querySelector(s):t.el=s,t.options=r({},u["default"],e),t.isInput="input"===t.el.tagName.toLowerCase(),t.attr=t.options.attr,t.bindInputFocusEvents=t.options.bindInputFocusEvents,t.showCursor=!t.isInput&&t.options.showCursor,t.cursorChar=t.options.cursorChar,t.cursorBlinking=!0,t.elContent=t.attr?t.el.getAttribute(t.attr):t.el.textContent,t.contentType=t.options.contentType,t.typeSpeed=t.options.typeSpeed,t.startDelay=t.options.startDelay,t.backSpeed=t.options.backSpeed,t.smartBackspace=t.options.smartBackspace,t.backDelay=t.options.backDelay,t.fadeOut=t.options.fadeOut,t.fadeOutClass=t.options.fadeOutClass,t.fadeOutDelay=t.options.fadeOutDelay,t.isPaused=!1,t.strings=t.options.strings.map(function(t){return t.trim()}),"string"==typeof t.options.stringsElement?t.stringsElement=document.querySelector(t.options.stringsElement):t.stringsElement=t.options.stringsElement,t.stringsElement){t.strings=[],t.stringsElement.style.display="none";var n=Array.prototype.slice.apply(t.stringsElement.children),i=n.length;if(i)for(var o=0;o<i;o+=1){var a=n[o];t.strings.push(a.innerHTML.trim())}}t.strPos=0,t.arrayPos=0,t.stopNum=0,t.loop=t.options.loop,t.loopCount=t.options.loopCount,t.curLoop=0,t.shuffle=t.options.shuffle,t.sequence=[],t.pause={status:!1,typewrite:!0,curString:"",curStrPos:0},t.typingComplete=!1;for(var o in t.strings)t.sequence[o]=o;t.currentElContent=this.getCurrentElContent(t),t.autoInsertCss=t.options.autoInsertCss,this.appendAnimationCss(t)}},{key:"getCurrentElContent",value:function(t){var e="";return e=t.attr?t.el.getAttribute(t.attr):t.isInput?t.el.value:"html"===t.contentType?t.el.innerHTML:t.el.textContent}},{key:"appendAnimationCss",value:function(t){if(t.autoInsertCss&&t.showCursor&&t.fadeOut){var e=document.createElement("style");e.type="text/css";var s="";t.showCursor&&(s+="\n        .typed-cursor{\n          opacity: 1;\n          animation: typedjsBlink 0.7s infinite;\n          -webkit-animation: typedjsBlink 0.7s infinite;\n                  animation: typedjsBlink 0.7s infinite;\n        }\n        @keyframes typedjsBlink{\n          50% { opacity: 0.0; }\n        }\n        @-webkit-keyframes typedjsBlink{\n          0% { opacity: 1; }\n          50% { opacity: 0.0; }\n          100% { opacity: 1; }\n        }\n      "),t.fadeOut&&(s+="\n        .typed-fade-out{\n          opacity: 0;\n          transition: opacity .25s;\n          -webkit-animation: 0;\n                  animation: 0;\n        }\n      "),0!==e.length&&(e.innerHTML=s,document.head.appendChild(e))}}}]),t}();e["default"]=l;var c=new l;e.initializer=c},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={strings:["These are the default values...","You know what you should do?","Use your own!","Have a great day!"],stringsElement:null,typeSpeed:0,startDelay:0,backSpeed:0,smartBackspace:!0,shuffle:!1,backDelay:700,fadeOut:!1,fadeOutClass:"typed-fade-out",fadeOutDelay:500,loop:!1,loopCount:1/0,showCursor:!0,cursorChar:"|",autoInsertCss:!0,attr:null,bindInputFocusEvents:!1,contentType:"html",onComplete:function(t){},preStringTyped:function(t,e){},onStringTyped:function(t,e){},onLastStringBackspaced:function(t){},onTypingPaused:function(t,e){},onTypingResumed:function(t,e){},onReset:function(t){},onStop:function(t,e){},onStart:function(t,e){},onDestroy:function(t){}};e["default"]=s,t.exports=e["default"]},function(t,e){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}(),i=function(){function t(){s(this,t)}return n(t,[{key:"typeHtmlChars",value:function(t,e,s){if("html"!==s.contentType)return e;var n=t.substr(e).charAt(0);if("<"===n||"&"===n){var i="";for(i="<"===n?">":";";t.substr(e+1).charAt(0)!==i&&(e++,!(e+1>t.length)););e++}return e}},{key:"backSpaceHtmlChars",value:function(t,e,s){if("html"!==s.contentType)return e;var n=t.substr(e).charAt(0);if(">"===n||";"===n){var i="";for(i=">"===n?"<":"&";t.substr(e-1).charAt(0)!==i&&(e--,!(e<0)););e--}return e}}]),t}();e["default"]=i;var r=new i;e.htmlParser=r}])});
//# sourceMappingURL=typed.min.js.map
}.call(window);

// type-sim.min.js, for SugarCube 2, by Chapel
;Macro.add("typesim",{tags:null,handler:function(){var t=$(document.createElement("textarea")),e=$(document.createElement("div"));if(1!==this.args.length)return this.error("incorrect number of arguments");if("string"!=typeof this.args[0])return this.error("argument should be a string");var r=this.args[0],a="",n=r.length,i=0,s="typesim-output-"+r.replace(/[^A-Za-z0-9]/g,""),o="macro-"+this.name,d=this.payload[0].contents;t.wiki(a).attr({id:s,readonly:!0}).addClass(o).appendTo(this.output),$(document).on("keydown","#"+s,function(t){i<n&&(a+=r.charAt(i),$("#"+s).empty().wiki(a)),i===n&&e.wiki(d).addClass(o).insertAfter("#"+s),i++})}});
// end type-sim.min.js







































</script><tw-tag name="savable" color="blue"></tw-tag>,<tw-tag name="nobr" color="gray"></tw-tag>,<tw-tag name="nav" color="green"></tw-tag>,<tw-tag name="puzzle" color="purple"></tw-tag>,<tw-tag name="named" color="orange"></tw-tag>,<tw-tag name="subarea" color="orange"></tw-tag>,<tw-tag name="keepsub" color="orange"></tw-tag>,<tw-tag name="hideinput" color="purple"></tw-tag>,<tw-tag name="widget" color="gray"></tw-tag><tw-passagedata pid="1" name="The Clearing" tags="named" position="194.33333333333334,218.33333333333331" size="100,100">&lt;&lt;if visited() == 1&gt;&gt;You awaken in a vast clearing of green and white. You should probably consider making some shelter for the night. If i could &lt;em&gt;gather&lt;/em&gt; some wood and &lt;em&gt;craft&lt;/em&gt; myself a small house, I could &lt;em&gt;use&lt;/em&gt; that.&lt;&lt;else&gt;&gt;
You are in the clearing.&lt;&lt;/if&gt;&gt;
&lt;&lt;if Flag(&quot;hasHouse&quot;)&gt;&gt;You see your [[homestead|Homestead]] standing firm in the snow.&lt;&lt;/if&gt;&gt;
You can your &lt;&lt;gather &#39;wood&#39; &#39;wood&#39; 10 10&gt;&gt;&lt;&lt;if $inventory.has(&#39;basic axe&#39;)&gt;&gt; (with &lt;&lt;set _wl to [&#39;wood&#39;, &#39;wood&#39;, &#39;wood&#39;]&gt;&gt;&lt;&lt;gather &#39;axe&#39; _wl 10 10&gt;&gt;)&lt;&lt;/if&gt;&gt; here.

&lt;&lt;if $days &gt;= 0&gt;&gt;A path to the [[south|Forest Path]] leads deeper in to the forest.&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="2" name="train" tags="" position="0,316" size="100,100">&lt;&lt;for _i, _n range $available_traits&gt;&gt;&lt;&lt;capture _n&gt;&gt;
	&lt;&lt;if $character.trait_levels[_n]&gt;&gt;\
		&lt;&lt;set _lvl to $character.trait_levels[_n] + 1&gt;&gt;\
		Upgrade &lt;&lt;link &#39;_n&#39;&gt;&gt;&lt;&lt;dialog&gt;&gt;&lt;&lt;addtrait _n&gt;&gt;\
		&lt;&lt;if $character.trait_levels[_n] == 3&gt;&gt;\
		Trait is max level. &lt;&lt;set $available_traits.delete(_n)&gt;&gt;&lt;&lt;/if&gt;&gt;
		&lt;&lt;/dialog&gt;&gt;&lt;&lt;set $character.sp to $character.sp - 1&gt;&gt;&lt;&lt;goto &#39;Home&#39;&gt;&gt;&lt;&lt;/link&gt;&gt; to level _lvl.
	&lt;&lt;else&gt;&gt;\
		Learn &lt;&lt;link &#39;_n&#39;&gt;&gt;&lt;&lt;dialog&gt;&gt;&lt;&lt;addtrait _n&gt;&gt;&lt;&lt;set $character.sp to $character.sp - 1&gt;&gt;&lt;&lt;goto &#39;Home&#39;&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;
	&lt;&lt;/if&gt;&gt;\
&lt;&lt;/capture&gt;&gt;&lt;&lt;/for&gt;&gt;
</tw-passagedata><tw-passagedata pid="3" name="StoryInit" tags="" position="425,0" size="100,100">&lt;&lt;set $kaiserdebug to true&gt;&gt;
&lt;&lt;set $varcaption to &quot;&quot;&gt;&gt;
&lt;&lt;include &#39;inventorystuff&#39;&gt;&gt;
&lt;&lt;include &#39;musicstuff&#39;&gt;&gt;
&lt;&lt;include &#39;npcs&#39;&gt;&gt;
&lt;&lt;set $days to 0&gt;&gt;
&lt;&lt;set $acmd to &quot;&quot;&gt;&gt;
&lt;&lt;set $commandset to &quot;&quot;&gt;&gt;
&lt;&lt;set $pnotes to [&#39;The notes system lets you take notes to remember specific things. Sometimes the game may also send messages here. Press the - button to delete notes, and the = to edit.&#39;]&gt;&gt;
&lt;&lt;set $party to []&gt;&gt;
&lt;&lt;set $allies_at_home to []&gt;&gt;
&lt;&lt;set $allies_at_home.push({&quot;name&quot;:&quot;Bailey&quot;, &quot;traits&quot;:[&#39;animal&#39;, &#39;small&#39;]})&gt;&gt;
&lt;&lt;set $allies_at_home.push({&quot;name&quot;:&quot;Claire&quot;, &quot;traits&quot;:[&#39;cute&#39;, &#39;agile&#39;]})&gt;&gt;
&lt;&lt;set $inventory to []&gt;&gt;
&lt;&lt;set $homechest to []&gt;&gt;
&lt;&lt;set $enemychest to []&gt;&gt;
&lt;&lt;newinventory &#39;$inventory&#39;&gt;&gt;
&lt;&lt;newinventory &#39;$homechest&#39;&gt;&gt;
&lt;&lt;newinventory &#39;$enemychest&#39;&gt;&gt;

&lt;&lt;set $available_traits to [&#39;poison resist&#39;, &#39;tough&#39;, &#39;muscled&#39;, &#39;keen eye&#39;, &#39;parkour&#39;]&gt;&gt;
&lt;&lt;set $blueprints to []&gt;&gt;
&lt;&lt;set $blueprints.push({&#39;name&#39;:&#39;small home&#39;, &#39;resources&#39;:{&#39;wood&#39;: 8}})&gt;&gt;

&lt;&lt;set $research to {}&gt;&gt;

&lt;&lt;set $character to {
&quot;str&quot;: 1,
&quot;dex&quot;: 1,
&quot;int&quot;: 1,
&quot;agi&quot;: 1,
&quot;hp&quot;: 100,
&quot;hpmax&quot;: 100,
&quot;en&quot;: 100,
&quot;enmax&quot;: 100, 
&quot;level&quot;: 1,
&quot;exp&quot;: 0,
&quot;sp&quot;: 0,
&quot;weapon&quot;: &quot;&quot;,
&quot;armour&quot;: &quot;&quot;,
&quot;name&quot;: &quot;&quot;,
&quot;credits&quot;: 200,
&quot;traits&quot;: [],
&quot;trait_levels&quot;: {},
&quot;ammo&quot;: {&#39;battery&#39;: 100, &#39;9mm&#39;: 0}
}&gt;&gt;

&lt;&lt;set $mprevious to &quot;&quot;&gt;&gt;
&lt;&lt;set $music to true&gt;&gt;
&lt;&lt;set $mature to false&gt;&gt;
&lt;&lt;set $escaped to false&gt;&gt;
&lt;&lt;set $enemy to {}&gt;&gt;
</tw-passagedata><tw-passagedata pid="4" name="PassageDone" tags="" position="950,0" size="200,100"></tw-passagedata><tw-passagedata pid="5" name="StoryMenu" tags="" position="325,0" size="100,100">&lt;&lt;link &#39;View Inventory&#39;&gt;&gt;
&lt;&lt;dialog &#39;Inventory&#39;&gt;&gt;\
!Inventory
&lt;&lt;if $inventory.toArray().length == 0&gt;&gt;Inventory is empty.&lt;&lt;/if&gt;&gt;\
&lt;&lt;for _i, _name range $inventory.toArray()&gt;&gt;&lt;&lt;capture _i, _name&gt;&gt;\
_name (&lt;&lt;link &#39;Use&#39;&gt;&gt;&lt;&lt;useitem _name _i&gt;&gt;&lt;&lt;/link&gt;&gt;)
&lt;&lt;set _inf to $invdef[_name]&gt;&gt;&lt;em&gt;&lt;&lt;if _inf&gt;&gt;_inf
&lt;&lt;/if&gt;&gt;&lt;/em&gt;&lt;&lt;/capture&gt;&gt;&lt;&lt;/for&gt;&gt;\
&lt;&lt;/dialog&gt;&gt;\
&lt;&lt;/link&gt;&gt;

&lt;&lt;link &#39;View Character&#39;&gt;&gt;
	&lt;&lt;dialog &#39;Character&#39;&gt;&gt;\
	  $character.name
	  Level: $character.level (&lt;&lt;print $character.exp&gt;&gt;% EXP)
	  $character.hp / $character.hpmax HP
	  $character.en / $character.enmax EN
	  Traits: 
	  &lt;&lt;for _name, _count range $character.trait_levels&gt;&gt;
	  _name (_count)
	  &lt;&lt;/for&gt;&gt;
	  &lt;&lt;if $party.length &gt; 0&gt;&gt;
	  &lt;&lt;for _i, _name range $party&gt;&gt;
	  &lt;&lt;capture _name&gt;&gt;_name.name
	  _name.traits&lt;&lt;/capture&gt;&gt;
	  &lt;&lt;/for&gt;&gt;
	  &lt;&lt;/if&gt;&gt;
	&lt;&lt;/dialog&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;&lt;if tags(passage()).contains(&quot;puzzle&quot;)&gt;&gt;
&lt;&lt;link &quot;&#39;&#39;Commands&#39;&#39;&quot;&gt;&gt;
	&lt;&lt;dialog &#39;aOS CMD&#39;&gt;&gt;&lt;&lt;include &#39;commandinput&#39;&gt;&gt;&lt;&lt;/dialog&gt;&gt;
&lt;&lt;/link&gt;&gt; 
&lt;&lt;else&gt;&gt;
&lt;&lt;link &quot;Commands&quot;&gt;&gt;
	&lt;&lt;dialog &#39;aOS CMD&#39;&gt;&gt;&lt;&lt;include &#39;commandinput&#39;&gt;&gt;&lt;&lt;/dialog&gt;&gt;
&lt;&lt;/link&gt;&gt; 
&lt;&lt;/if&gt;&gt;
&lt;&lt;link &#39;Crafting&#39;&gt;&gt;
	&lt;&lt;dialog &#39;Crafting&#39;&gt;&gt;&lt;&lt;include &#39;crafting&#39;&gt;&gt;&lt;&lt;/dialog&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;&lt;link &#39;Notes&#39;&gt;&gt;
	&lt;&lt;popup &#39;panelnotes&#39;&gt;&gt;
&lt;&lt;/link&gt;&gt;</tw-passagedata><tw-passagedata pid="6" name="BattleStart" tags="nobr" position="1000,400" size="100,100">&lt;&lt;audio &quot;:playing&quot; pause&gt;&gt;
&lt;&lt;audio $enemy.bgm volume 0 fadein&gt;&gt;
&lt;&lt;set $action to &quot;&quot;&gt;&gt;
&lt;&lt;set $endcondition to 0&gt;&gt;/*1 - win, 2 - escaped, 3 - died*/
&lt;&lt;set $mprevious to previous()&gt;&gt;
&lt;&lt;clear &#39;$enemychest&#39;&gt;&gt;
&lt;&lt;pickup &#39;$enemychest&#39; $enemy.loot&gt;&gt;
&lt;&lt;set $battleturns to 0&gt;&gt;
&lt;&lt;goto &#39;Battle&#39;&gt;&gt;
</tw-passagedata><tw-passagedata pid="7" name="Battle" tags="" position="1100,400" size="100,100">&lt;&lt;set $battleturns to $battleturns + 1&gt;&gt; TURN $battleturns
&lt;&lt;if $outdmg &gt;= 0&gt;&gt;You did $outdmg damage to $enemy.name&lt;&lt;/if&gt;&gt;\
&lt;&lt;set $outdmg to -1&gt;&gt;\
&lt;&lt;if $battleturns &gt; 1 and random(10) &gt; $enemy.speed and $enemy.str &gt; 0&gt;&gt;\
&lt;&lt;set _min to $enemy.str - 5&gt;&gt;&lt;&lt;set _max to $enemy.str + 5&gt;&gt;\
&lt;&lt;set _dmg to random(_min, _max)&gt;&gt;The enemy hits you for _dmg.
&lt;&lt;set $character.hp to $character.hp - _dmg&gt;&gt;\
&lt;&lt;/if&gt;&gt;
$enemy.name has $enemy.hp health.
You have $character.hp health.
&lt;&lt;if $enemy.hp &lt;= 0&gt;&gt;\
&lt;&lt;notify&gt;&gt;You strike $enemy.name and defeated it.&lt;&lt;/notify&gt;&gt;\
&lt;&lt;set $endcondition to 1&gt;&gt;\
&lt;&lt;goto &#39;BattleEnd&#39;&gt;&gt;\
&lt;&lt;/if&gt;&gt;\
&lt;&lt;if $character.hp &lt;= 0&gt;&gt;\
&lt;&lt;notify&gt;&gt;You died.&lt;&lt;/notify&gt;&gt;\
&lt;&lt;set $endcondition to 3&gt;&gt;\
&lt;&lt;goto &#39;BattleEnd&#39;&gt;&gt;\
&lt;&lt;/if&gt;&gt;\

&lt;&lt;nobr&gt;&gt;&lt;&lt;link &#39;Strike&#39;&gt;&gt;
  &lt;&lt;set _min to 0&gt;&gt;&lt;&lt;set _max to 25&gt;&gt;\
  &lt;&lt;set $outdmg to random(_min, _max)&gt;&gt;\
  &lt;&lt;set $enemy.hp to $enemy.hp - $outdmg&gt;&gt;\
  &lt;&lt;goto &#39;Battle&#39;&gt;&gt;
&lt;&lt;/link&gt;&gt;. 
&lt;&lt;for _i, _name range clone($inventory.toArray())&gt;&gt;&lt;&lt;capture _name&gt;&gt;
&lt;&lt;if $weaponchart[_name]&gt;&gt;&lt;&lt;link &#39;Attack&#39;&gt;&gt;\
  &lt;&lt;set _min to $weaponchart[_name] - 5&gt;&gt;&lt;&lt;set _max to $weaponchart[_name]&gt;&gt;\
  &lt;&lt;set $outdmg to random(_min, _max)&gt;&gt;\
  &lt;&lt;set $enemy.hp to $enemy.hp - $outdmg&gt;&gt;\
  &lt;&lt;goto &#39;Battle&#39;&gt;&gt;&lt;&lt;/link&gt;&gt; with &lt;b&gt;_name&lt;/b&gt;.
  &lt;&lt;elseif _name == &quot;medkit&quot;&gt;&gt;&lt;&lt;link &#39;Heal&#39;&gt;&gt;&lt;&lt;set $character.hp to $character.hp + 50&gt;&gt;&lt;&lt;goto &#39;Battle&#39;&gt;&gt;&lt;&lt;/link&gt;&gt; with &lt;b&gt;_name&lt;/b&gt;.
&lt;&lt;/if&gt;&gt;
&lt;&lt;/capture&gt;&gt;&lt;&lt;/for&gt;&gt;
&lt;&lt;/nobr&gt;&gt;
&lt;&lt;link &#39;Escape&#39;&gt;&gt;
  &lt;&lt;goto &#39;BattleEnd&#39;&gt;&gt;
  &lt;&lt;set $endcondition to 2&gt;&gt;
  &lt;&lt;notify&gt;&gt;You try to escape.&lt;&lt;/notify&gt;&gt;
&lt;&lt;/link&gt;&gt;\</tw-passagedata><tw-passagedata pid="8" name="BattleEnd" tags="" position="1200,400" size="100,100">&lt;&lt;if $endcondition == 1&gt;&gt;
You gain $enemy.credits credits.
&lt;&lt;if clone($enemychest.toArray()).length &gt; 0&gt;&gt;They dropped some &lt;&lt;link &#39;loot&#39;&gt;&gt;&lt;&lt;dialog&gt;&gt;&lt;&lt;linkedinventory &#39;Take&#39; &#39;$enemychest&#39; &#39;$inventory&#39;&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;/if&gt;&gt;
&lt;&lt;gainxp $enemy.exp&gt;&gt;
&lt;&lt;set $character.credits to $character.credits + $enemy.credits&gt;&gt;
Return to &lt;&lt;link &#39;last area&#39;&gt;&gt;&lt;&lt;goto $mprevious&gt;&gt;&lt;&lt;/link&gt;&gt;.
&lt;&lt;elseif $endcondition == 2&gt;&gt;
You ran away.
Return to &lt;&lt;link &#39;last area&#39;&gt;&gt;&lt;&lt;goto $mprevious&gt;&gt;&lt;&lt;/link&gt;&gt;.
&lt;&lt;elseif $endcondition == 3&gt;&gt;
You died. But this is a prototype so just go home.
[[Home]]
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="9" name="ChestTake" tags="" position="0,0" size="100,100">&lt;&lt;if $homechest.toArray().length == 0&gt;&gt;Chest is empty.&lt;&lt;/if&gt;&gt;\
&lt;&lt;for _i, _name range $homechest.toArray()&gt;&gt;&lt;&lt;capture _i, _name&gt;&gt;\
&lt;&lt;link &#39;Take&#39;&gt;&gt;\
&lt;&lt;set _tmp to $homechest.toArray().deleteAt(_i)&gt;&gt;
&lt;&lt;pickup &#39;$inventory&#39; _tmp&gt;&gt;&lt;&lt;dialog &#39;Chest Management&#39;&gt;&gt;&lt;&lt;include &#39;ChestTake&#39;&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt; _name
&lt;&lt;/capture&gt;&gt;&lt;&lt;/for&gt;&gt;
----
&lt;&lt;link &#39;Switch to Deposit&#39;&gt;&gt;&lt;&lt;dialog &#39;Chest Management&#39;&gt;&gt;&lt;&lt;include &#39;ChestDeposit&#39;&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;</tw-passagedata><tw-passagedata pid="10" name="ChestDeposit" tags="" position="0,103" size="100,100">&lt;&lt;if $inventory.toArray().length == 0&gt;&gt;Inventory is empty.&lt;&lt;/if&gt;&gt;\
&lt;&lt;for _i, _name range $inventory.toArray()&gt;&gt;&lt;&lt;capture _i, _name&gt;&gt;\
&lt;&lt;link &#39;Store&#39;&gt;&gt;\
&lt;&lt;set _tmp to $inventory.toArray().deleteAt(_i)&gt;&gt;
&lt;&lt;pickup &#39;$homechest&#39; _tmp&gt;&gt;&lt;&lt;dialog &#39;Chest Management&#39;&gt;&gt;&lt;&lt;include &#39;ChestDeposit&#39;&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt; _name
&lt;&lt;/capture&gt;&gt;&lt;&lt;/for&gt;&gt;
----
&lt;&lt;link &#39;Switch to Taking&#39;&gt;&gt;&lt;&lt;dialog &#39;Chest Management&#39;&gt;&gt;&lt;&lt;include &#39;ChestTake&#39;&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;</tw-passagedata><tw-passagedata pid="11" name="PassageReady" tags="" position="1151.6666666666667,0" size="200,100">&lt;&lt;if tags().includes(&#39;named&#39;)&gt;&gt;
	&lt;&lt;set $varcaption to &quot;&#39;&#39;Area&#39;&#39;: &quot;+passage()&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if tags().includes(&#39;subarea&#39;)&gt;&gt;
	&lt;&lt;set $varcaption2 to &quot;(&quot;+passage()+&quot;)&quot;&gt;&gt;
&lt;&lt;elseif not tags().includes(&quot;keepsub&quot;)&gt;&gt;
	&lt;&lt;set $varcaption2 to &quot;&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="12" name="widgets" tags="widget" position="840,0" size="100,100">&lt;&lt;widget &#39;addtrait&#39;&gt;&gt;\
	&lt;&lt;if $character.trait_levels[$args[0]]&gt;&gt;\
		&lt;&lt;set _lvl to $character.trait_levels[$args[0]] + 1&gt;&gt;\
		&lt;&lt;set $character.trait_levels[$args[0]] to _lvl&gt;&gt;\
		Trait $args[0] is now level _lvl.\
	&lt;&lt;else&gt;&gt;\
		&lt;&lt;set $character.trait_levels[$args[0]] to 1&gt;&gt;\
		&lt;&lt;set $character.traits.push($args[0])&gt;&gt;\
		You learned $args[0] trait.\
	&lt;&lt;/if&gt;&gt;\
&lt;&lt;/widget&gt;&gt;\

&lt;&lt;widget &#39;shop&#39;&gt;&gt;
	//Your credits//: $character.credits
	
	&lt;&lt;for _i, _array range $shopArray&gt;&gt;\
		&lt;&lt;capture _i, _array&gt;&gt;\
			&lt;b&gt;_array[0]&lt;/b&gt; (_array[1])
			&lt;em&gt;&lt;&lt;if $invdef[_array[0]]&gt;&gt;&lt;&lt;print $invdef[_array[0]]&gt;&gt;	&lt;&lt;else&gt;&gt;Nothing special.&lt;&lt;/if&gt;&gt;&lt;/em&gt;
			&lt;&lt;if $character.credits &gt;= _array[1]&gt;&gt;&lt;&lt;link &#39;Buy&#39;&gt;&gt;\
				&lt;&lt;dialog&gt;&gt;\
					You buy _array[0] for _array[1].
					&lt;&lt;set $shopArray[0].delete(_array)&gt;&gt;
					&lt;&lt;goto [[passage()]]&gt;&gt;\
				&lt;&lt;/dialog&gt;&gt;
			&lt;&lt;/link&gt;&gt;&lt;&lt;else&gt;&gt;==Buy== (Can&#39;t afford)&lt;&lt;/if&gt;&gt;
		&lt;&lt;/capture&gt;&gt;\
	&lt;&lt;/for&gt;&gt;\
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &#39;add_codex&#39;&gt;&gt;
	&lt;&lt;for _i, _name range $computer.codex&gt;&gt;
		&lt;&lt;capture _name&gt;&gt;\
			&lt;&lt;print &#39;$args[0]&#39;&gt;&gt;
		&lt;&lt;/capture&gt;&gt;
	&lt;&lt;/for&gt;&gt;
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &#39;gainxp&#39;&gt;&gt;\
	&lt;&lt;set $character.exp to $character.exp + $args[0]&gt;&gt;\
	&lt;&lt;print &#39;You gained $args[0] EXP.&lt;br&gt;&lt;progress class=&quot;exp&quot; @value=&quot;$character.exp&quot; max=&quot;100&quot;&gt;&lt;/progress&gt; ($character.exp / 100)&#39;&gt;&gt;
	&lt;&lt;if $character.exp &gt;= 100&gt;&gt;\
	You gained a level!
	&lt;&lt;set $character.level to $character.level + 1&gt;&gt;\
	&lt;&lt;set $character.sp to $character.sp + 1&gt;&gt;\
	&lt;&lt;set $character.exp to $character.exp - 100&gt;&gt;&lt;&lt;/if&gt;&gt;
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &#39;addcodex&#39;&gt;&gt;\
	&lt;&lt;set $computer.codex.push({&quot;msg&quot;:$args[1], &quot;name&quot;:$args[0]})&gt;&gt;\
	&lt;&lt;if $args[2] == &quot;print&quot;&gt;&gt;$args[1]\&lt;&lt;/if&gt;&gt;
	@@.fade-in-out;New codex data gained.@@\
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &#39;quickdialog&#39;&gt;&gt;
	&lt;&lt;dialog $args[1]&gt;&gt;$args[0]&lt;&lt;/dialog&gt;&gt;
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &#39;randomencounter&#39;&gt;&gt;\
	&lt;&lt;if random(100) &lt;= $args[0] and $mprevious != passage()&gt;&gt;\
		&lt;&lt;set $enemy to $args[1]&gt;&gt;\
		&lt;&lt;if $args[2]&gt;&gt;\
			&lt;&lt;quickdialog &#39;$enemy.name jumps at you.&#39;&gt;&gt;
			&lt;&lt;goto &#39;BattleStart&#39;&gt;&gt;\
		&lt;&lt;else&gt;&gt;\
		  A $enemy.name is here.
		  &lt;&lt;link &#39;Fight&#39;&gt;&gt;&lt;&lt;goto &#39;BattleStart&#39;&gt;&gt;&lt;&lt;/link&gt;&gt;\
		&lt;&lt;/if&gt;&gt;\
	&lt;&lt;/if&gt;&gt;\
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &#39;kplay&#39;&gt;&gt;\
	&lt;&lt;if not $kaiserdebug&gt;&gt;&lt;&lt;audio &quot;:playing&quot; stop&gt;&gt;&lt;&lt;if $music&gt;&gt;&lt;&lt;audio $args[0] loop play&gt;&gt;&lt;&lt;/if&gt;&gt;&lt;&lt;/if&gt;&gt;\
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &#39;takeenergy&#39;&gt;&gt;\
	&lt;&lt;set $character.en to $character.en - $args[0]&gt;&gt;\
	Used $args[0] energy.
	&lt;&lt;print &#39;&lt;progress @value=&quot;$character.en&quot; max=&quot;100&quot;&gt;&lt;/progress&gt; ($character.en / $character.enmax)&#39;&gt;&gt;\
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &#39;takedamage&#39;&gt;&gt;\
	&lt;&lt;set $character.hp to $character.hp - $args[0]&gt;&gt;\
	&lt;&lt;print &#39;&lt;progress @value=&quot;$character.hp&quot; max=&quot;100&quot;&gt;&lt;/progress&gt; ($character.hp / $character.hpmax)&#39;&gt;&gt;\
&lt;&lt;/widget&gt;&gt;

&lt;&lt;widget &#39;healdamage&#39;&gt;&gt;\
	&lt;&lt;set $character.hp to $character.hp + $args[0]&gt;&gt;\
	&lt;&lt;if $character.hp &gt; $character.hpmax&gt;&gt;&lt;&lt;set $character.hp to $character.hpmax&gt;&gt;&lt;&lt;/if&gt;&gt;\
	&lt;&lt;print &#39;&lt;progress @value=&quot;$character.hp&quot; max=&quot;100&quot;&gt;&lt;/progress&gt; ($character.hp / $character.hpmax)&#39;&gt;&gt;\
&lt;&lt;/widget&gt;&gt;</tw-passagedata><tw-passagedata pid="13" name="crafting" tags="" position="1,528" size="100,100">&lt;&lt;widget &#39;craft&#39;&gt;&gt;\
	&lt;&lt;for _name, _i range $args[0].resources&gt;&gt;&lt;&lt;capture _i, _name&gt;&gt;\
		&lt;&lt;for _i to 0; _i lt $args[0].resources[_name]; _i++&gt;&gt;\
			&lt;&lt;drop &#39;$inventory&#39; _name&gt;&gt;\
			Removed _name.
		&lt;&lt;/for&gt;&gt;\
	&lt;&lt;/capture&gt;&gt;&lt;&lt;/for&gt;&gt;\
	&lt;&lt;pickup &#39;$inventory&#39; $args[0].name&gt;&gt;\
	Gained $args[0].name.
	&lt;&lt;link &#39;Back&#39;&gt;&gt;&lt;&lt;dialog &#39;Crafting&#39;&gt;&gt;&lt;&lt;include &#39;crafting&#39;&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;\
&lt;&lt;/widget&gt;&gt;\
&lt;&lt;for _i, _name range $blueprints&gt;&gt;&lt;&lt;capture _name&gt;&gt;\
	&lt;&lt;set _ok to true&gt;&gt;
	_name.name 
	&lt;&lt;for _res, _count range _name.resources&gt;&gt;&lt;&lt;capture _res _count&gt;&gt;\
		_res (x_count) &lt;&lt;if $inventory.count(_res) &lt; _count&gt;&gt;&lt;&lt;set _ok to false&gt;&gt;(Incomplete)&lt;&lt;/if&gt;&gt;\
	&lt;&lt;/capture&gt;&gt;&lt;&lt;/for&gt;&gt;\
	&lt;&lt;if _ok&gt;&gt;&lt;&lt;link &#39;Create&#39;&gt;&gt;&lt;&lt;dialog&gt;&gt;&lt;&lt;craft _name&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;/if&gt;&gt;
&lt;&lt;/capture&gt;&gt;&lt;&lt;/for&gt;&gt;</tw-passagedata><tw-passagedata pid="14" name="inventorystuff" tags="" position="625,0" size="200,100">&lt;&lt;set $weaponchart to {
&#39;combat knife&#39;: 20,
&#39;nano-tech blade&#39;: 50
}&gt;&gt;

&lt;&lt;set $invdef to {
&#39;medkit&#39;:&#39;Healing item. Usable in battle 1x. Usable in field.&#39;,
&#39;k card&#39;:&#39;Keycard with numbers 1-7 written and a symbol of a sun on the front. The letter K is engraved on the back.&#39;,
&#39;combat knife&#39;:&#39;Attacking weapon. Used in battle (20str).&#39;,
&#39;rope&#39;: &#39;Useful tool, various uses.&#39;,
&#39;plant killer&#39;: &#39;Instantly kills vines and weeds.&#39;,
&#39;nano-tech blade&#39;: &#39;Combat weapon. Used in battle (50str).&#39;,
&#39;book: nanomancery&#39;: &quot;Teaches Nanomancery skill.&quot;,
&#39;map: south hell&#39;: &quot;Discovers new locations.&quot;,
&#39;agent corpse&#39;: &quot;Remains of an Agent.&quot;,
&#39;1-4 card&#39;: &#39;Card to apartment 1-4 of Sunrise.&#39;,
&#39;prototype shock rifle&#39;: &#39;An unfinished energy weapon capable of destroying mechanical targets easily. Does not currently work.&#39;
}&gt;&gt;</tw-passagedata><tw-passagedata pid="15" name="musicstuff" tags="" position="525,0" size="100,100">
&lt;&lt;masteraudio volume 1&gt;&gt;</tw-passagedata><tw-passagedata pid="16" name="npcs" tags="" position="125,0" size="100,100">&lt;&lt;set $wilddog to {
&#39;name&#39;:&#39;wild dog&#39;,
&#39;str&#39;: 5,
&#39;hp&#39;:15, 
&#39;hpmax&#39;:15,
&#39;exp&#39;: 10,
&#39;credits&#39;: 0,
&#39;speed&#39;: 9,
&#39;loot&#39;: [&#39;fur&#39;, &#39;meat&#39;]
}&gt;&gt;

&lt;&lt;set $rabbit to {
&#39;name&#39;:&#39;rabbit&#39;,
&#39;str&#39;: 3,
&#39;hp&#39;:20, 
&#39;hpmax&#39;:20,
&#39;exp&#39;: 15,
&#39;credits&#39;: 0,
&#39;speed&#39;: 10,
&#39;loot&#39;: [&#39;fur&#39;, &#39;meat&#39;]
}&gt;&gt;</tw-passagedata><tw-passagedata pid="17" name="panelnotes" tags="" position="225,0" size="100,100">&lt;&lt;textbox &#39;_tstr&#39; &#39;&#39;&gt;&gt;&lt;&lt;button &#39;+&#39;&gt;&gt;&lt;&lt;set $pnotes.push(_tstr)&gt;&gt;&lt;&lt;popup &#39;panelnotes&#39;&gt;&gt;&lt;&lt;/button&gt;&gt;

&lt;&lt;for _i, _n range $pnotes&gt;&gt;&lt;&lt;capture _i, _n&gt;&gt;\
&lt;&lt;button &#39;-&#39;&gt;&gt;&lt;&lt;set $pnotes.deleteAt(_i)&gt;&gt;&lt;&lt;popup &#39;panelnotes&#39;&gt;&gt;&lt;&lt;/button&gt;&gt;&lt;&lt;button &#39;=&#39;&gt;&gt;\
&lt;&lt;dialog&gt;&gt;&lt;&lt;textbox &#39;_editstr&#39; _n&gt;&gt;&lt;&lt;button &#39;Edit&#39;&gt;&gt;&lt;&lt;set $pnotes[_i] to _editstr&gt;&gt;&lt;&lt;popup &#39;panelnotes&#39;&gt;&gt;&lt;&lt;/button&gt;&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/button&gt;&gt; _n 
&lt;&lt;/capture&gt;&gt;&lt;&lt;/for&gt;&gt;\</tw-passagedata><tw-passagedata pid="18" name="commandparser" tags="nobr" position="625,200" size="200,100">&lt;&lt;set _data to $acmd&gt;&gt;
&lt;&lt;set _arr to _data.split(&quot; &quot;)&gt;&gt;
&lt;&lt;set _arr.deleteAt(0)&gt;&gt;
&lt;&lt;set $commandargs to _arr.join(&quot; &quot;)&gt;&gt;

&lt;&lt;if $acmd == &quot;help&quot;&gt;&gt;\
	&lt;&lt;dialog &#39;Help&#39;&gt;&gt;\
		&#39;&#39;General&#39;&#39; &lt;br&gt;
		help: this.&lt;br&gt;
		&lt;br&gt;
		&#39;&#39;Puzzle-specific&#39;&#39; &lt;br&gt;
		look - gets a feel for the room&lt;br&gt;
		take - holds an item, either from the room or inventory&lt;br&gt;
		use - use an item or object in room&lt;br&gt;
		
	&lt;&lt;/dialog&gt;&gt;
&lt;&lt;elseif $acmd.startsWith(&quot;goto&quot;)&gt;&gt;
	&lt;&lt;goto $commandargs&gt;&gt;
&lt;&lt;else&gt;&gt;
	&lt;&lt;if tags(passage()).contains(&quot;puzzle&quot;)&gt;&gt;
		&lt;&lt;set $commandset to $acmd&gt;&gt;
		&lt;&lt;goto [[passage()]]&gt;&gt;
	&lt;&lt;else&gt;&gt;
		&lt;&lt;quickdialog &#39;Invalid command&#39;&gt;&gt;
	&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;set $acmd to &quot;&quot;&gt;&gt;</tw-passagedata><tw-passagedata pid="19" name="commandinput" tags="" position="625,100" size="200,100">&lt;&lt;textbox &quot;$acmd&quot; &quot;&quot; autofocus&gt;&gt;&lt;&lt;button &#39;Submit&#39;&gt;&gt;&lt;&lt;include &#39;commandparser&#39;&gt;&gt;&lt;&lt;/button&gt;&gt;</tw-passagedata><tw-passagedata pid="20" name="item_data" tags="widget" position="840,101.66666666666667" size="100,100">&lt;&lt;widget &#39;useitem&#39;&gt;&gt;\
	&lt;&lt;switch $args[0]&gt;&gt;
		&lt;&lt;case &quot;small home&quot;&gt;&gt;\
			&lt;&lt;drop &#39;$inventory&#39; &quot;small home&quot;&gt;&gt;
			&lt;&lt;dialog&gt;&gt;&lt;&lt;if not Flag(&quot;hasHouse&quot;)&gt;&gt;
			&lt;&lt;set $blueprints.push({&#39;name&#39;:&#39;wooden spear&#39;, &#39;resources&#39;:{&#39;wood&#39;: 4}})&gt;&gt;@@.fade-in-out;You learn how to craft a wooden spear.@@
			&lt;&lt;set $blueprints.push({&#39;name&#39;:&#39;wooden bed&#39;, &#39;resources&#39;:{&#39;wood&#39;: 2}})&gt;&gt;@@.fade-in-out;You learn how to craft a wooden bed.@@
			&lt;&lt;/if&gt;&gt;
			You set up a wooden house.&lt;&lt;setFlag &quot;hasHouse&quot;&gt;&gt;&lt;&lt;/dialog&gt;&gt;
			&lt;&lt;run reloadPassage()&gt;&gt;
		&lt;&lt;default&gt;&gt;\
			&lt;&lt;dialog&gt;&gt;The $args[0] doesn&#39;t do anything here.&lt;&lt;/dialog&gt;&gt;
	&lt;&lt;/switch&gt;&gt;\
&lt;&lt;/widget&gt;&gt;\</tw-passagedata><tw-passagedata pid="21" name="StoryBanner" tags="" position="950,100" size="200,100"></tw-passagedata><tw-passagedata pid="22" name="StoryCaption" tags="" position="950,200" size="200,100">&lt;&lt;print $varcaption&gt;&gt; &lt;&lt;print $varcaption2&gt;&gt;</tw-passagedata><tw-passagedata pid="23" name="PassageHeader" tags="" position="1151.6666666666667,103.33333333333333" size="200,100">&lt;&lt;if tags().contains(&quot;puzzle&quot;) and not tags().contains(&quot;hideinput&quot;)&gt;&gt;\
&lt;&lt;include &#39;commandinput&#39;&gt;&gt;

&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="24" name="tags list" tags="" position="0,423" size="100,100">named: sets the sidebar name for the area
subarea: sets the sub-name in the sidebar
keepsub: doesn&#39;t reset the sub-name to blank like usual
puzzle: enables command line
hideinput: doesnt add the command line to the page
nav: adds the area to navigation</tw-passagedata><tw-passagedata pid="25" name="research" tags="" position="0,210" size="100,100">&lt;&lt;button &#39;Back&#39;&gt;&gt;&lt;&lt;goto &#39;Home&#39;&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;button &#39;Debug&#39;&gt;&gt;&lt;&lt;set $research.pantheon.count to $research.pantheon.count + 5&gt;&gt;&lt;&lt;goto &#39;research&#39;&gt;&gt;&lt;&lt;/button&gt;&gt;

&lt;&lt;for _i, _n range $research&gt;&gt;&lt;&lt;capture _i, _n&gt;&gt;
&#39;&#39;_n.description&#39;&#39; &lt;&lt;percent _n.count _n.max&gt;&gt;
&lt;progress class=&quot;bar&quot; @value=&quot;_n.count&quot; @max=&quot;_n.max&quot;&gt;&lt;/progress&gt;
&lt;&lt;/capture&gt;&gt;&lt;&lt;/for&gt;&gt;
</tw-passagedata><tw-passagedata pid="26" name="Flags" tags="widget nobr" position="840,200" size="100,100">/*  SetFlag : Set Flag X to value Y (Y defaults to True).  Flag names are NOT case sensitive.  */
/*  EXAMPLE: &lt;&lt;SetFlag &quot;Mentor&quot; &quot;Bob&quot;&gt;&gt;  */
/*  EXAMPLE: &lt;&lt;SetFlag &quot;TrialMed&quot;&gt;&gt;  = sets TrialMed flag to True  */
&lt;&lt;widget &quot;setFlag&quot;&gt;&gt;
	&lt;&lt;set _Fnam = $args[0].toLowerCase()&gt;&gt;
	&lt;&lt;if ndef $Flags&gt;&gt;
		&lt;&lt;set $Flags = {}&gt;&gt;
	&lt;&lt;/if&gt;&gt;
	&lt;&lt;if def $args[1]&gt;&gt;
		&lt;&lt;if $args[1] == false&gt;&gt;
			&lt;&lt;if def $Flags[_Fnam]&gt;&gt;
				&lt;&lt;run delete $Flags[_Fnam]&gt;&gt;
			&lt;&lt;/if&gt;&gt;
		&lt;&lt;else&gt;&gt;
			&lt;&lt;set $Flags[_Fnam] = $args[1]&gt;&gt;
		&lt;&lt;/if&gt;&gt;
	&lt;&lt;else&gt;&gt;
		&lt;&lt;set $Flags[_Fnam] = true&gt;&gt;
	&lt;&lt;/if&gt;&gt;
	/* Event flags: */
	/* Keep track of your flags here, for example: */
	/* Mentor = Bob or Joe */
	/* TrialMed = denotes whether you&#39;ve agreed to take Dr. Acula&#39;s medication */
&lt;&lt;/widget&gt;&gt;</tw-passagedata><tw-passagedata pid="27" name="error" tags="widget nobr" position="839.3333333333334,301.3333333333333" size="100,100">&lt;&lt;widget &quot;error&quot;&gt;&gt;
	&lt;&lt;if ($args.length == 2) &amp;&amp; (typeof $args[0] === &quot;string&quot;) &amp;&amp; (typeof $args[1] === &quot;string&quot;)&gt;&gt;
		&lt;&lt;if ndef _errNo&gt;&gt;
			&lt;&lt;set _errNo = 1&gt;&gt;
			&lt;&lt;run $(document).one(&quot;:passagerender&quot;,
				function (ev) {
					$(ev.content).find(&quot;.errmsg&quot;).each(function (idx) {
						throwError($(this), $(this).data(&quot;msg&quot;), $(this).data(&quot;src&quot;));
					});
				}
			)&gt;&gt;
		&lt;&lt;else&gt;&gt;
			&lt;&lt;set _errNo += 1&gt;&gt;
		&lt;&lt;/if&gt;&gt;
		&lt;span class=&quot;errmsg&quot; @data-msg=&quot;$args[0]&quot; @data-src=&quot;$args[1]&quot;&gt;&lt;/span&gt;
	&lt;&lt;else&gt;&gt;
		&lt;&lt;ErrMsg &#39;&lt;&lt;ErrMsg&gt;&gt; must have two string parameters.&#39; &#39;Example: &lt;&lt;ErrMsg &quot;Main text.&quot; &quot;Details.&quot;&gt;&gt;&#39;&gt;&gt;
	&lt;&lt;/if&gt;&gt;
&lt;&lt;/widget&gt;&gt;</tw-passagedata><tw-passagedata pid="28" name="glitch" tags="widget nobr" position="839.6666666666667,406.3333333333333" size="100,100">&lt;&lt;widget &quot;glitch&quot;&gt;&gt;
&lt;&lt;set _main to $args[0]&gt;&gt;
&lt;&lt;if not $args[1]&gt;&gt;&lt;&lt;set _second to clone(_main)&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;set _second to clone($args[1])&gt;&gt;&lt;&lt;/if&gt;&gt;
&lt;span class=&quot;glitchy&quot; @data-text=_second&gt;_main&lt;/span&gt;
&lt;&lt;/widget&gt;&gt;</tw-passagedata><tw-passagedata pid="29" name="Homestead" tags="subarea" position="400,215.99999999999997" size="200,100">You are home.
You have a &lt;&lt;link &#39;storage chest&#39;&gt;&gt;&lt;&lt;dialog &#39;Chest Management&#39;&gt;&gt;&lt;span id=&quot;chesttype&quot;&gt;&lt;&lt;if $taking&gt;&gt;&lt;&lt;include &quot;ChestTake&quot;&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;include &quot;ChestDeposit&quot;&gt;&gt;&lt;&lt;/if&gt;&gt;&lt;/span&gt;&lt;&lt;/dialog&gt;&gt;&lt;&lt;/link&gt;&gt;
&lt;&lt;if $inventory.has(&#39;wooden bed&#39;) and not Flag(&#39;homestead_bed&#39;)&gt;&gt;\
You can &lt;&lt;link &#39;build&#39;&gt;&gt;\
&lt;&lt;drop &#39;$inventory&#39; &quot;wooden bed&quot;&gt;&gt;
&lt;&lt;setFlag &#39;homestead_bed&#39;&gt;&gt;
&lt;&lt;goto &#39;Homestead&#39;&gt;&gt;
&lt;&lt;/link&gt;&gt; a bed here.
&lt;&lt;/if&gt;&gt;\
&lt;&lt;if Flag(&#39;homestead_bed&#39;)&gt;&gt;
You can &lt;&lt;link &#39;sleep&#39;&gt;&gt;
&lt;&lt;goto &#39;sleeping&#39;&gt;&gt;
&lt;&lt;/link&gt;&gt; here.
&lt;&lt;/if&gt;&gt;
&lt;&lt;button &#39;Exit&#39;&gt;&gt;&lt;&lt;goto &#39;The Clearing&#39;&gt;&gt;&lt;&lt;/button&gt;&gt;</tw-passagedata><tw-passagedata pid="30" name="sleeping" tags="subarea" position="293,117.33333333333331" size="100,100">&lt;&lt;switch $days&gt;&gt;
	&lt;&lt;case 0&gt;&gt;&lt;&lt;glitch &#39;Your first day in the clearing, you did well.&#39; &#39;I\&#39;ll be waiting for you in the sky.&#39;&gt;&gt;
	&lt;&lt;case 1&gt;&gt;Second day.
&lt;&lt;/switch&gt;&gt;

&lt;&lt;set $days to $days + 1&gt;&gt;
&lt;&lt;set $character.en to $character.enmax&gt;&gt;
You sleep until tomorrow, and so begins day $days.

&lt;&lt;link &#39;Wake up&#39;&gt;&gt;&lt;&lt;goto [[previous()]]&gt;&gt;&lt;&lt;/link&gt;&gt;</tw-passagedata><tw-passagedata pid="31" name="Forest Path" tags="named" position="200.99999999999994,384.16666666666674" size="100,100">&lt;&lt;if visited() == 1&gt;&gt;
You take in the surroundings and decide your next move. You see some water and some mountains around, and get the idea to use some of the natural resources to enhance your equipment.
&lt;&lt;set $blueprints.push({&#39;name&#39;:&#39;stone sword&#39;, &#39;resources&#39;:{&#39;wood&#39;: 1, &#39;stone&#39;: 2}})&gt;&gt;@@.fade-in-out;You learn how to craft a stone sword.@@
&lt;&lt;set $blueprints.push({&#39;name&#39;:&#39;basic axe&#39;, &#39;resources&#39;:{&#39;wood&#39;: 2, &#39;stone&#39;: 2}})&gt;&gt;@@.fade-in-out;You learn how to craft a basic axe.@@
&lt;&lt;set $blueprints.push({&#39;name&#39;:&#39;basic pickaxe&#39;, &#39;resources&#39;:{&#39;wood&#39;: 2, &#39;stone&#39;: 2}})&gt;&gt;@@.fade-in-out;You learn how to craft a basic pickaxe.@@
&lt;&lt;/if&gt;&gt;
&lt;&lt;randomencounter 80 $rabbit&gt;&gt;
&lt;&lt;set _gath to [&#39;leaves&#39;, &#39;twigs&#39;]&gt;&gt;
You can gather &lt;&lt;gather &#39;leaves&#39; _gath 10 10&gt;&gt; here.
North leads to [[The Clearing]].

South leads to [[The Lake]].

East leads to [[The Mountain Path]].</tw-passagedata><tw-passagedata pid="32" name="The Lake" tags="named" position="202.66666666666663,562.5" size="100,100">&lt;&lt;randomencounter 80 $rabbit&gt;&gt;
North leads to the [[Forest Path]].</tw-passagedata><tw-passagedata pid="33" name="The Mountain Path" tags="named" position="369.33333333333326,385.83333333333337" size="100,100">You can gather &lt;&lt;gather &#39;stones&#39; &#39;stone&#39; 20 10&gt;&gt; here.

West leads to the [[Forest Path]].</tw-passagedata><tw-passagedata pid="34" name="gathering" tags="widget" position="841,509.1666666666667" size="100,100">$arg[0] = text\
$arg[1] = material\
$arg[2] = energy use\
$arg[3] = EXP gain\
&lt;&lt;widget &#39;gather&#39;&gt;&gt;\
  &lt;&lt;link $args[0]&gt;&gt;\
  &lt;&lt;if hasEnergy($args[2])&gt;&gt;
  &lt;&lt;dialog&gt;&gt;\
  Gained $args[1].&lt;&lt;pickup &#39;$inventory&#39; $args[1]&gt;&gt;&lt;&lt;gainxp $args[3]&gt;&gt;&lt;&lt;takeenergy $args[2]&gt;&gt;&lt;&lt;/dialog&gt;&gt;
  &lt;&lt;else&gt;&gt;
  &lt;&lt;dialog&gt;&gt;Too tired to gather.&lt;&lt;/dialog&gt;&gt;
  &lt;&lt;/if&gt;&gt;\
  &lt;&lt;/link&gt;&gt;\
&lt;&lt;/widget&gt;&gt;\</tw-passagedata></tw-storydata>